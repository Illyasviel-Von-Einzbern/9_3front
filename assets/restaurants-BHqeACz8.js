import{ab as Me,r as g,aq as Se,e as S,w as o,d as Fe,o as u,c as l,f as j,ae as x,q as c,i as d,F as G,s as K,V as v,ac as L,a9 as De,j as Te,ai as i,an as Pe,ao as qe,h as t,aj as Ae,ak as ze,al as Be,ad as Re,ar as $e,ap as Oe}from"./index-AWgwsy0c.js";import{u as je,c as te,f as Ne,e as Q,a as b,b as re,d as y}from"./index.esm-D7IRi73Z.js";import{B as Ee}from"./BusinessHours-DYhOC6bX.js";import{r as F}from"./restaurant-wEHn5vvw.js";import{b as ne}from"./route-block-B_A1xBdJ.js";import{V as He}from"./VContainer-DdjiTbVz.js";import{V as N,a as p}from"./VRow-DgrlSwcS.js";import{V as ue}from"./VDivider-DMIPa6pT.js";import{V as Ie}from"./VDataTable-BWFFZXyR.js";import{V as We}from"./VRating-Crk21thQ.js";import{V as X}from"./VChip-BXeRU_1z.js";import{a as Je}from"./VToolbar-BlAZ4Cry.js";import{V as Ge}from"./VForm-BiP2f0f4.js";import{V as de}from"./VSelect-C4kuFK5Q.js";import{V as Y}from"./VCheckbox-DO8XisfU.js";import{V as Ke}from"./VCombobox-BQXtuI6i.js";import{V as ie,a as me,b as pe,c as ce}from"./VExpansionPanels-BaXzTRH7.js";import{V as Le}from"./VFileInput-Cl5Qo54s.js";import"./VPagination-DoiRKGmI.js";import"./VCheckboxBtn-DDuY08wn.js";import"./filter-C9uyxmCX.js";import"./VList-Dn2VOZxI.js";import"./VMenu-DoDXjbwU.js";const Qe={key:0},Xe={key:1,class:"text-grey"},Ye={key:0},Ze={key:1,class:"text-grey"},el={key:0},ll={class:"ml-1"},al={key:1,class:"text-grey"},sl={class:"mb-4"},ol={__name:"restaurants",setup(tl){const f=Me(),Z=g([]),E=g(""),ve=[{title:"圖片",key:"image",sortable:!1},{title:"名稱",key:"name"},{title:"分類",key:"category"},{title:"電話",key:"phone",sortable:!1},{title:"地址",key:"address",sortable:!1},{title:"網址",key:"link",sortable:!1},{title:"標籤",key:"tags",sortable:!1},{title:"評論",key:"reviews",sortable:!1},{title:"平均評分",key:"average_score",sortable:!0},{title:"評論數量",key:"review_count",sortable:!0},{title:"外送",key:"delivery"},{title:"外送金額",key:"delivery_price"},{title:"外送數量",key:"delivery_number"},{title:"營業時間",key:"business_hours"},{title:"訂餐時間",key:"order_time"},{title:"上架",key:"sell"},{title:"狀態",key:"isDeleted"},{title:"操作",key:"action",sortable:!1}],fe=["name","category","phone","address"],D=async()=>{try{const{data:s}=await F.getAllAdmin();console.log("撈到的餐廳資料:",s),Z.value=Array.isArray(s==null?void 0:s.data)?s.data:[]}catch(s){console.error("載入餐廳失敗:",s),f({text:"無法載入餐廳資料",snackbarProps:{color:"red"}})}};D();const m=g({open:!1,id:""}),w=Se("fileAgent"),ee=s=>{s?(m.value.id=s._id,T.value.value=s.name,P.value.value=s.phone,q.value.value=s.address,A.value.value=s.link,z.value.value=s.category,M.value.value=s.delivery,B.value.value=s.delivery_price,R.value.value=s.delivery_number,W.value.value=s.order_time,$.value.value=s.sell,U.value=s.tags&&s.tags.length>0?s.tags.map(a=>a.name||a):[],s.image&&(C.value=[{name:"restaurant-image.jpg",size:0,type:"image/jpeg",url:s.image,file:null}]),k.value=s.menu&&s.menu.length>0?[...s.menu]:[],s.business_hours&&s.business_hours.length>0?_.value=s.business_hours.map(a=>({...a})):H()):(m.value.id="",se(),H(),U.value=[],k.value=[],h.value=null,w.value&&w.value.deleteFileRecord()),m.value.open=!0},H=()=>{_.value=[{day:"Mon",open:"09:00",close:"18:00",isClosed:!1},{day:"Tue",open:"09:00",close:"18:00",isClosed:!1},{day:"Wed",open:"09:00",close:"18:00",isClosed:!1},{day:"Thu",open:"09:00",close:"18:00",isClosed:!1},{day:"Fri",open:"09:00",close:"18:00",isClosed:!1},{day:"Sat",open:"09:00",close:"18:00",isClosed:!1},{day:"Sun",open:"09:00",close:"18:00",isClosed:!1}]},Ve=()=>{for(const s of _.value)s.isClosed=!1,s.open="09:00",s.close="18:00"},ye=()=>{for(const s of _.value){const a=s.day==="Sat"||s.day==="Sun";s.isClosed=a,a||(s.open="09:00",s.close="18:00")}},ge=()=>{for(const s of _.value)s.isClosed=!0},be=()=>{k.value.push({name:"",price:0,description:""})},ke=s=>{k.value.splice(s,1)},_e=async s=>{var a,V;if(confirm("確定要刪除這間餐廳嗎？此操作無法復原。"))try{await F.delete(s),f({text:"餐廳刪除成功！",snackbarProps:{color:"green"}}),D()}catch(e){console.error("刪除餐廳失敗:",e);const n=((V=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:V.message)||(e==null?void 0:e.message)||"刪除失敗，請稍後再試";f({text:n,snackbarProps:{color:"red"}})}},Ce=async s=>{var a,V;if(confirm("確定要恢復這間餐廳嗎？"))try{const e=new FormData;e.append("isDeleted","false"),await F.update(s,e),f({text:"餐廳恢復成功！",snackbarProps:{color:"green"}}),D()}catch(e){console.error("恢復餐廳失敗:",e);const n=((V=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:V.message)||(e==null?void 0:e.message)||"恢復失敗，請稍後再試";f({text:n,snackbarProps:{color:"red"}})}},le=()=>{m.value.open=!1,m.value.id="",se(),H(),U.value=[],k.value=[],h.value=null,w.value&&w.value.deleteFileRecord()},ae=["食物","飲料","其他"],xe=[{title:"星期一",value:"Mon"},{title:"星期二",value:"Tue"},{title:"星期三",value:"Wed"},{title:"星期四",value:"Thu"},{title:"星期五",value:"Fri"},{title:"星期六",value:"Sat"},{title:"星期日",value:"Sun"}],U=g([]),k=g([]),_=g([{day:"Mon",open:"09:00",close:"18:00",isClosed:!1},{day:"Tue",open:"09:00",close:"18:00",isClosed:!1},{day:"Wed",open:"09:00",close:"18:00",isClosed:!1},{day:"Thu",open:"09:00",close:"18:00",isClosed:!1},{day:"Fri",open:"09:00",close:"18:00",isClosed:!1},{day:"Sat",open:"09:00",close:"18:00",isClosed:!1},{day:"Sun",open:"09:00",close:"18:00",isClosed:!1}]),{handleSubmit:Ue,resetForm:se,isSubmitting:I}=je({validationSchema:te({name:b().required("餐廳名稱必須填寫").max(100),phone:b().required("餐廳電話必須填寫"),address:b().max(60),link:b().url("請輸入有效網址").max(100),category:b().required().oneOf(ae),delivery:Q().required(),delivery_price:re().min(0).when("delivery",{is:!0,then:s=>s.required("外送金額必填")}),delivery_number:re().min(0).when("delivery",{is:!0,then:s=>s.required("外送份數必填")}),order_time:b(),sell:Q().required(),business_hours:Ne().of(te({day:b().required(),open:b().when("isClosed",{is:!1,then:s=>s.required("開始時間必填")}),close:b().when("isClosed",{is:!1,then:s=>s.required("結束時間必填")}),isClosed:Q().required()}))}),initialValues:{name:"",phone:"",address:"",link:"",category:"",delivery:!1,delivery_price:0,delivery_number:0,order_time:"",sell:!0}}),T=y("name"),P=y("phone"),q=y("address"),A=y("link"),z=y("category"),M=y("delivery"),B=y("delivery_price"),R=y("delivery_number"),W=y("order_time"),$=y("sell"),C=g([]),oe=g([]),h=g(null),he=Ue(async s=>{var V,e,n;if((V=C.value[0])!=null&&V.error){f({text:"請選擇有效圖片",snackbarProps:{color:"red"}});return}if(m.value.id.length===0&&C.value.length===0){f({text:"請上傳餐廳圖片",snackbarProps:{color:"red"}});return}if(_.value.filter(r=>r.isClosed?!1:!r.open||!r.close).length>0){f({text:"請完整填寫營業時間",snackbarProps:{color:"red"}});return}try{const r=new FormData;for(const[we,J]of Object.entries(s))J!=null&&r.append(we,J);r.append("tags",JSON.stringify(U.value)),k.value.length>0&&r.append("menu",JSON.stringify(k.value)),r.append("business_hours",JSON.stringify(_.value)),C.value.length>0&&r.append("image",C.value[0].file),h.value&&r.append("menuImage",h.value);const O=m.value.id.length>0,rl=O?await F.update(m.value.id,r):await F.create(r);f({text:O?"餐廳更新成功！":"餐廳新增成功！",snackbarProps:{color:"green"}}),le(),D()}catch(r){console.error("餐廳操作失敗:",r);const O=((n=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:n.message)||(r==null?void 0:r.message)||"操作失敗，請稍後再試";f({text:O,snackbarProps:{color:"red"}})}});return(s,a)=>{const V=Fe("VueFileAgent");return u(),S(He,{fluid:""},{default:o(()=>[l(N,null,{default:o(()=>[l(p,{cols:"12"},{default:o(()=>a[17]||(a[17]=[j("h1",{class:"text-center"},"餐廳管理",-1)])),_:1,__:[17]}),l(ue),l(p,{cols:"12"},{default:o(()=>[l(Ie,{"filter-keys":fe,headers:ve,items:Z.value,search:E.value},{top:o(()=>[l(Je,null,{default:o(()=>[l(v,{variant:"outlined",onClick:a[0]||(a[0]=e=>ee(null))},{default:o(()=>a[18]||(a[18]=[d(" 新增餐廳 ",-1)])),_:1,__:[18]}),l(Te),l(i,{modelValue:E.value,"onUpdate:modelValue":a[1]||(a[1]=e=>E.value=e),density:"compact","hide-details":"",placeholder:"搜尋餐廳","prepend-inner-icon":"mdi-magnify",variant:"solo"},null,8,["modelValue"])]),_:1})]),"item.image":o(({value:e})=>[l(De,{src:e,width:"75"},null,8,["src"])]),"item.delivery":o(({value:e})=>[l(L,{icon:e?"mdi-check":"mdi-close"},null,8,["icon"])]),"item.sell":o(({value:e})=>[l(L,{icon:e?"mdi-check":"mdi-close"},null,8,["icon"])]),"item.isDeleted":o(({value:e})=>[l(X,{color:e?"error":"success",size:"small",variant:"outlined"},{default:o(()=>[d(x(e?"已刪除":"正常"),1)]),_:2},1032,["color"])]),"item.action":o(({item:e})=>[l(v,{disabled:e.isDeleted,icon:"mdi-pencil",variant:"text",onClick:n=>ee(e)},null,8,["disabled","onClick"]),e.isDeleted?(u(),S(v,{key:1,color:"success",icon:"mdi-restore",variant:"text",onClick:n=>Ce(e._id)},null,8,["onClick"])):(u(),S(v,{key:0,color:"error",icon:"mdi-delete",variant:"text",onClick:n=>_e(e._id)},null,8,["onClick"]))]),"item.business_hours":o(({value:e})=>[l(Ee,{hours:e},null,8,["hours"])]),"item.tags":o(({value:e})=>[e&&e.length>0?(u(),c("div",Qe,[(u(!0),c(G,null,K(e,n=>(u(),S(X,{key:n._id,class:"ma-1",color:"primary",size:"small",variant:"outlined"},{default:o(()=>[d(x(n.name),1)]),_:2},1024))),128))])):(u(),c("span",Xe,"無標籤"))]),"item.reviews":o(({value:e})=>[e&&e.length>0?(u(),c("div",Ye,[l(X,{color:"success",size:"small",variant:"outlined"},{default:o(()=>[d(x(e.length)+" 則評論 ",1)]),_:2},1024)])):(u(),c("span",Ze,"無評論"))]),"item.average_score":o(({value:e})=>[e&&e>0?(u(),c("div",el,[l(We,{density:"compact","half-increments":"","model-value":e,readonly:"",size:"small"},null,8,["model-value"]),j("span",ll,x(e.toFixed(1)),1)])):(u(),c("span",al,"無評分"))]),"item.review_count":o(({value:e})=>[j("span",null,x(e||0),1)]),_:2},1032,["items","search"])]),_:1})]),_:1}),l(Pe,{modelValue:m.value.open,"onUpdate:modelValue":a[16]||(a[16]=e=>m.value.open=e),persistent:"",width:"900"},{default:o(()=>[l(Ge,{disabled:t(I),onSubmit:qe(t(he),["prevent"])},{default:o(()=>[l(Ae,null,{default:o(()=>[l(ze,null,{default:o(()=>[d(x(m.value.id?"編輯餐廳":"新增餐廳"),1)]),_:1}),l(Be,null,{default:o(()=>[l(i,{modelValue:t(T).value.value,"onUpdate:modelValue":a[2]||(a[2]=e=>t(T).value.value=e),"error-messages":t(T).errorMessage.value,label:"名稱"},null,8,["modelValue","error-messages"]),l(i,{modelValue:t(P).value.value,"onUpdate:modelValue":a[3]||(a[3]=e=>t(P).value.value=e),"error-messages":t(P).errorMessage.value,label:"電話"},null,8,["modelValue","error-messages"]),l(i,{modelValue:t(q).value.value,"onUpdate:modelValue":a[4]||(a[4]=e=>t(q).value.value=e),"error-messages":t(q).errorMessage.value,label:"地址"},null,8,["modelValue","error-messages"]),l(i,{modelValue:t(A).value.value,"onUpdate:modelValue":a[5]||(a[5]=e=>t(A).value.value=e),"error-messages":t(A).errorMessage.value,label:"連結"},null,8,["modelValue","error-messages"]),l(de,{modelValue:t(z).value.value,"onUpdate:modelValue":a[6]||(a[6]=e=>t(z).value.value=e),"error-messages":t(z).errorMessage.value,items:ae,label:"分類"},null,8,["modelValue","error-messages"]),l(Y,{modelValue:t(M).value.value,"onUpdate:modelValue":a[7]||(a[7]=e=>t(M).value.value=e),"error-messages":t(M).errorMessage.value,"hide-details":"",label:"是否外送"},null,8,["modelValue","error-messages"]),t(M).value.value?(u(),S(N,{key:0},{default:o(()=>[l(p,{cols:"6"},{default:o(()=>[l(i,{modelValue:t(B).value.value,"onUpdate:modelValue":a[8]||(a[8]=e=>t(B).value.value=e),modelModifiers:{number:!0},"error-messages":t(B).errorMessage.value,label:"外送金額",min:"0",type:"number"},null,8,["modelValue","error-messages"])]),_:1}),l(p,{cols:"6"},{default:o(()=>[l(i,{modelValue:t(R).value.value,"onUpdate:modelValue":a[9]||(a[9]=e=>t(R).value.value=e),modelModifiers:{number:!0},"error-messages":t(R).errorMessage.value,label:"外送份數",min:"0",type:"number"},null,8,["modelValue","error-messages"])]),_:1})]),_:1})):Re("",!0),l(i,{modelValue:t(W).value.value,"onUpdate:modelValue":a[10]||(a[10]=e=>t(W).value.value=e),label:"訂餐時間"},null,8,["modelValue"]),l(Ke,{modelValue:U.value,"onUpdate:modelValue":a[11]||(a[11]=e=>U.value=e),chips:"",clearable:"","hide-details":"",label:"標籤",multiple:"",placeholder:"早餐、午餐、飲料、飯、麵、餃子．．．等","small-chips":""},null,8,["modelValue"]),l(ie,null,{default:o(()=>[l(me,null,{default:o(()=>[l(pe,null,{default:o(()=>a[19]||(a[19]=[d("營業時間設定",-1)])),_:1,__:[19]}),l(ce,null,{default:o(()=>[j("div",sl,[l($e,null,{default:o(()=>[l(v,{size:"small",onClick:Ve},{default:o(()=>a[20]||(a[20]=[d("全部營業",-1)])),_:1,__:[20]}),l(v,{size:"small",onClick:ye},{default:o(()=>a[21]||(a[21]=[d("平日營業",-1)])),_:1,__:[21]}),l(v,{size:"small",onClick:ge},{default:o(()=>a[22]||(a[22]=[d("全部休息",-1)])),_:1,__:[22]})]),_:1})]),(u(!0),c(G,null,K(_.value,e=>(u(),c("div",{key:e.day,class:"mb-3"},[l(N,null,{default:o(()=>[l(p,{cols:"3"},{default:o(()=>[l(de,{modelValue:e.day,"onUpdate:modelValue":n=>e.day=n,density:"compact",items:xe,label:"星期"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(p,{cols:"3"},{default:o(()=>[l(Y,{modelValue:e.isClosed,"onUpdate:modelValue":n=>e.isClosed=n,density:"compact","hide-details":"",label:"休息"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(p,{cols:"3"},{default:o(()=>[l(i,{modelValue:e.open,"onUpdate:modelValue":n=>e.open=n,density:"compact",disabled:e.isClosed,label:"開始時間",type:"time"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024),l(p,{cols:"3"},{default:o(()=>[l(i,{modelValue:e.close,"onUpdate:modelValue":n=>e.close=n,density:"compact",disabled:e.isClosed,label:"結束時間",type:"time"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024)]),_:2},1024)]))),128))]),_:1})]),_:1})]),_:1}),l(Y,{modelValue:t($).value.value,"onUpdate:modelValue":a[12]||(a[12]=e=>t($).value.value=e),"error-messages":t($).errorMessage.value,"hide-details":"",label:"上架"},null,8,["modelValue","error-messages"]),l(ie,null,{default:o(()=>[l(me,null,{default:o(()=>[l(pe,null,{default:o(()=>a[23]||(a[23]=[d("菜單管理",-1)])),_:1,__:[23]}),l(ce,null,{default:o(()=>[(u(!0),c(G,null,K(k.value,(e,n)=>(u(),c("div",{key:n,class:"my-2"},[l(N,{align:"center",dense:"",style:{gap:"12px"}},{default:o(()=>[l(p,{cols:"4"},{default:o(()=>[l(i,{modelValue:e.name,"onUpdate:modelValue":r=>e.name=r,clearable:"",dense:"",label:"項目",placeholder:"請輸入菜名"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(p,{cols:"2"},{default:o(()=>[l(i,{modelValue:e.price,"onUpdate:modelValue":r=>e.price=r,modelModifiers:{number:!0},clearable:"",dense:"",label:"價格",placeholder:"0",type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(p,{cols:"4"},{default:o(()=>[l(i,{modelValue:e.description,"onUpdate:modelValue":r=>e.description=r,clearable:"",dense:"",label:"描述",placeholder:"請輸入描述"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(p,{class:"d-flex justify-center",cols:"1"},{default:o(()=>[l(v,{color:"error",icon:"",small:"",title:"刪除",onClick:r=>ke(n)},{default:o(()=>[l(L,null,{default:o(()=>a[24]||(a[24]=[d("mdi-delete",-1)])),_:1,__:[24]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),l(ue)]))),128)),l(v,{color:"success",onClick:be},{default:o(()=>a[25]||(a[25]=[d("＋ 新增菜單項目",-1)])),_:1,__:[25]})]),_:1})]),_:1})]),_:1}),l(Le,{modelValue:h.value,"onUpdate:modelValue":a[13]||(a[13]=e=>h.value=e),accept:"image/png, image/jpeg",label:"菜單圖片（選填）","prepend-icon":"mdi-image","show-size":""},null,8,["modelValue"]),l(V,{ref_key:"fileAgent",ref:w,modelValue:C.value,"onUpdate:modelValue":a[14]||(a[14]=e=>C.value=e),"raw-model-value":oe.value,"onUpdate:rawModelValue":a[15]||(a[15]=e=>oe.value=e),accept:"image/jpeg,image/png",deletable:"","error-text":{type:"檔案格式不正確",size:"檔案大小不得超過 1MB"},"help-text":"選擇或拖拽圖片","max-size":"1MB"},null,8,["modelValue","raw-model-value"])]),_:1}),l(Oe,null,{default:o(()=>[l(v,{color:"red",disabled:t(I),onClick:le},{default:o(()=>a[26]||(a[26]=[d("取消",-1)])),_:1,__:[26]},8,["disabled"]),l(v,{color:"green",loading:t(I),type:"submit"},{default:o(()=>[d(x(m.value.id?"編輯":"新增"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])]),_:1})}}};typeof ne=="function"&&ne(ol);export{ol as default};
