import{_ as Z,r as p,v as h,z as ee,e as S,o as f,w as s,c as a,aj as le,ak as ae,i as m,al as oe,ad as J,f as g,q as U,a9 as se,ai as r,ar as ue,V,F as M,s as T,ac as j,ap as te,j as de,ao as ne}from"./index-CIHyU37z.js";import{u as _,w as re,r as ie}from"./xlsx-DFGycjb8.js";import{u as me}from"./restaurantStore-DsKeZ-6r.js";import{V as C}from"./VFileInput-W2sxFRqm.js";import{V as z}from"./VSelect-CxX8EwAn.js";import{V as pe}from"./VCombobox-MnIzVKHD.js";import{V as w}from"./VSwitch-Ln00XI-d.js";import{V as F,a as i}from"./VRow-BQerUWQv.js";import{V as O}from"./VDivider-3u-8eSsr.js";import{V as Ve}from"./VCheckbox-Bq7NSs5r.js";import{V as ve}from"./VTextarea-d6ZWnqqs.js";import{V as fe}from"./VForm-CGGqa3P4.js";const ce={class:"mb-4"},ye={__name:"RestaurantForm",emits:["success"],setup(be,{emit:B}){const A=B,E=me(),N=p(null),o=p({name:"",phone:"",address:"",link:"",category:"",tags:[],delivery:!1,delivery_price:0,delivery_number:0,order_time:"",sell:!0,menu:[]}),I=["食物","飲料","其他"],c=p([{day:"Mon",open:"09:00",close:"18:00",isClosed:!1},{day:"Tue",open:"09:00",close:"18:00",isClosed:!1},{day:"Wed",open:"09:00",close:"18:00",isClosed:!1},{day:"Thu",open:"09:00",close:"18:00",isClosed:!1},{day:"Fri",open:"09:00",close:"18:00",isClosed:!1},{day:"Sat",open:"09:00",close:"18:00",isClosed:!1},{day:"Sun",open:"09:00",close:"18:00",isClosed:!1}]),D=[{title:"星期一",value:"Mon"},{title:"星期二",value:"Tue"},{title:"星期三",value:"Wed"},{title:"星期四",value:"Thu"},{title:"星期五",value:"Fri"},{title:"星期六",value:"Sat"},{title:"星期日",value:"Sun"}],v=p(null),y=p(null),L=h(()=>v.value?URL.createObjectURL(v.value):null),W=u=>u?u.size>1024*1024?"檔案過大（1MB 以下）":!0:"必須上傳圖片",k=p("");function G(){try{const u=JSON.parse(k.value);Array.isArray(u)?o.value.menu=u.map(e=>({name:e.name||"",price:e.price||0,description:e.description||"",image:null})):alert("JSON 格式錯誤，請確認為陣列格式")}catch{alert("無法解析 JSON")}}const b=p(null),x=p(!1);ee(b,u=>{if(!u)return;const e=new FileReader;e.addEventListener("load",l=>{try{const d=new Uint8Array(l.target.result),t=ie(d,{type:"array"}),Y=t.Sheets[t.SheetNames[0]],R=_.sheet_to_json(Y).map(n=>({name:n.name||n.菜名||n.品項||n.項目||"",price:n.price||n.價格||n.單價||0,description:n.description||n.描述||n.說明||"",image:null})).filter(n=>n.name||n.price);x.value?o.value.menu=o.value.menu.concat(R):o.value.menu=R}catch(d){console.error("Excel 解析錯誤",d),alert("無法解析 Excel，請確認檔案內容是否正確")}finally{b.value=null}}),e.readAsArrayBuffer(u)});function q(){o.value.menu.push({name:"",price:0,description:"",image:null})}function $(u){o.value.menu.splice(u,1)}const H=()=>{for(const u of c.value)u.isClosed=!1,u.open="09:00",u.close="18:00"},K=()=>{for(const u of c.value){const e=u.day==="Sat"||u.day==="Sun";u.isClosed=e,e||(u.open="09:00",u.close="18:00")}},P=()=>{for(const u of c.value)u.isClosed=!0};async function Q(){if(!await N.value.validate())return;const e=new FormData;e.append("name",o.value.name),e.append("phone",o.value.phone),e.append("address",o.value.address||""),e.append("link",o.value.link||""),e.append("category",o.value.category),e.append("tags",JSON.stringify(o.value.tags||[])),e.append("delivery",o.value.delivery),e.append("delivery_price",o.value.delivery_price),e.append("delivery_number",o.value.delivery_number),e.append("order_time",o.value.order_time),e.append("sell",o.value.sell?"true":"false"),v.value&&e.append("image",v.value),o.value.menu.length>0&&e.append("menu",JSON.stringify(o.value.menu)),e.append("business_hours",JSON.stringify(c.value)),y.value&&e.append("menuImage",y.value);try{await E.createRestaurant(e),A("success")}catch(l){console.error("新增失敗",l)}}function X(){const u=[{name:"菜名範例",price:100,description:"描述範例"}],e=_.json_to_sheet(u),l=_.book_new();_.book_append_sheet(l,e,"菜單範本"),re(l,"menu_template.xlsx")}return(u,e)=>(f(),S(fe,{ref_key:"formRef",ref:N,onSubmit:ne(Q,["prevent"])},{default:s(()=>[a(le,{class:"pa-4"},{default:s(()=>[a(ae,null,{default:s(()=>e[16]||(e[16]=[m("📋 餐廳資訊",-1)])),_:1,__:[16]}),a(oe,null,{default:s(()=>[a(C,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=l=>v.value=l),accept:"image/png, image/jpeg",label:"上傳圖片","prepend-icon":"mdi-image",rules:[W],"show-size":""},null,8,["modelValue","rules"]),v.value?(f(),S(se,{key:0,class:"my-3",cover:"",height:"200",src:L.value},null,8,["src"])):J("",!0),a(r,{modelValue:o.value.name,"onUpdate:modelValue":e[1]||(e[1]=l=>o.value.name=l),label:"餐廳名稱",rules:[l=>!!l||"必填"]},null,8,["modelValue","rules"]),a(r,{modelValue:o.value.phone,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.phone=l),label:"餐廳電話",rules:[l=>!!l||"必填"]},null,8,["modelValue","rules"]),a(r,{modelValue:o.value.address,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.address=l),label:"餐廳地址"},null,8,["modelValue"]),a(r,{modelValue:o.value.link,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.link=l),label:"餐廳外部連結（GOOGLE、FB）"},null,8,["modelValue"]),a(z,{modelValue:o.value.category,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.category=l),items:I,label:"分類",required:"",rules:[l=>!!l||"必填"]},null,8,["modelValue","rules"]),a(pe,{modelValue:o.value.tags,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.tags=l),chips:"",clearable:"","hide-details":"",label:"標籤",multiple:"",placeholder:"早餐、午餐、飲料、飯、麵、餃子．．．等","small-chips":""},null,8,["modelValue"]),a(w,{modelValue:o.value.delivery,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.delivery=l),color:"primary",label:"提供外送服務"},null,8,["modelValue"]),o.value.delivery?(f(),S(F,{key:1},{default:s(()=>[a(i,{cols:"6"},{default:s(()=>[a(r,{modelValue:o.value.delivery_price,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.delivery_price=l),modelModifiers:{number:!0},label:"外送最低金額",prefix:"$",type:"number"},null,8,["modelValue"])]),_:1}),a(i,{cols:"6"},{default:s(()=>[a(r,{modelValue:o.value.delivery_number,"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.delivery_number=l),modelModifiers:{number:!0},label:"外送所需份數",suffix:"份",type:"number"},null,8,["modelValue"])]),_:1})]),_:1})):J("",!0),a(r,{modelValue:o.value.order_time,"onUpdate:modelValue":e[10]||(e[10]=l=>o.value.order_time=l),label:"最後點餐時間"},null,8,["modelValue"]),a(w,{modelValue:o.value.sell,"onUpdate:modelValue":e[11]||(e[11]=l=>o.value.sell=l),label:"是否上架"},null,8,["modelValue"]),a(O,{class:"my-4"}),e[25]||(e[25]=g("h3",{class:"text-h6 mb-2"},"🕒 營業時間設定",-1)),g("div",ce,[a(ue,null,{default:s(()=>[a(V,{size:"small",onClick:H},{default:s(()=>e[17]||(e[17]=[m("全部營業",-1)])),_:1,__:[17]}),a(V,{size:"small",onClick:K},{default:s(()=>e[18]||(e[18]=[m("平日營業",-1)])),_:1,__:[18]}),a(V,{size:"small",onClick:P},{default:s(()=>e[19]||(e[19]=[m("全部休息",-1)])),_:1,__:[19]})]),_:1})]),(f(!0),U(M,null,T(c.value,l=>(f(),U("div",{key:l.day,class:"mb-3"},[a(F,null,{default:s(()=>[a(i,{cols:"3"},{default:s(()=>[a(z,{modelValue:l.day,"onUpdate:modelValue":d=>l.day=d,density:"compact",items:D,label:"星期"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(i,{cols:"3"},{default:s(()=>[a(Ve,{modelValue:l.isClosed,"onUpdate:modelValue":d=>l.isClosed=d,density:"compact","hide-details":"",label:"休息"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(i,{cols:"3"},{default:s(()=>[a(r,{modelValue:l.open,"onUpdate:modelValue":d=>l.open=d,density:"compact",disabled:l.isClosed,label:"開始時間",type:"time"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024),a(i,{cols:"3"},{default:s(()=>[a(r,{modelValue:l.close,"onUpdate:modelValue":d=>l.close=d,density:"compact",disabled:l.isClosed,label:"結束時間",type:"time"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024)]),_:2},1024)]))),128)),a(O,{class:"my-4"}),e[26]||(e[26]=g("h3",{class:"text-h6 mb-2"},"📦 快速新增菜單",-1)),a(C,{modelValue:y.value,"onUpdate:modelValue":e[12]||(e[12]=l=>y.value=l),accept:"image/png, image/jpeg",class:"mb-3",label:"整體菜單圖片（選填）","prepend-icon":"mdi-image","show-size":""},null,8,["modelValue"]),a(V,{class:"mb-3",color:"green darken-1",dark:"",elevation:"2",onClick:X},{default:s(()=>[a(j,{left:""},{default:s(()=>e[20]||(e[20]=[m("mdi-download",-1)])),_:1,__:[20]}),e[21]||(e[21]=m(" 下載範本 Excel ",-1))]),_:1,__:[21]}),a(C,{modelValue:b.value,"onUpdate:modelValue":e[13]||(e[13]=l=>b.value=l),accept:".xlsx",label:"上傳 Excel（含欄位 name, price, description）","prepend-icon":"mdi-file-excel","show-size":""},null,8,["modelValue"]),a(w,{modelValue:x.value,"onUpdate:modelValue":e[14]||(e[14]=l=>x.value=l),class:"mb-4",inset:"",label:"匯入菜單時： 覆蓋（關閉） / 合併（開啟）"},null,8,["modelValue"]),a(ve,{modelValue:k.value,"onUpdate:modelValue":e[15]||(e[15]=l=>k.value=l),"auto-grow":"",label:"或貼上 JSON 陣列",placeholder:'[{"name": "咖哩飯", "price": 100, "description": "美味"}]',rows:"5"},null,8,["modelValue"]),a(V,{class:"mt-2 mb-6",color:"primary",onClick:G},{default:s(()=>e[22]||(e[22]=[m("📥 匯入 JSON",-1)])),_:1,__:[22]}),e[27]||(e[27]=g("h3",{class:"text-h6 mb-2"},"📝 菜單編輯",-1)),(f(!0),U(M,null,T(o.value.menu,(l,d)=>(f(),U("div",{key:d,class:"my-2"},[a(F,{align:"center",dense:"",style:{gap:"8px"}},{default:s(()=>[a(i,{cols:"2"},{default:s(()=>[a(C,{modelValue:l.image,"onUpdate:modelValue":t=>l.image=t,accept:"image/png, image/jpeg",density:"compact","hide-details":"",label:"項目圖片","prepend-icon":"mdi-image","show-size":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(i,{cols:"3"},{default:s(()=>[a(r,{modelValue:l.name,"onUpdate:modelValue":t=>l.name=t,clearable:"",dense:"",label:"項目",placeholder:"請輸入菜名",rules:[t=>!!t||"必填"]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),a(i,{cols:"2"},{default:s(()=>[a(r,{modelValue:l.price,"onUpdate:modelValue":t=>l.price=t,modelModifiers:{number:!0},clearable:"",dense:"",label:"價格",placeholder:"0",rules:[t=>t>=0||"價格不能小於 0"],type:"number"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),a(i,{cols:"3"},{default:s(()=>[a(r,{modelValue:l.description,"onUpdate:modelValue":t=>l.description=t,clearable:"",dense:"",label:"描述",placeholder:"請輸入描述"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(i,{class:"d-flex justify-center",cols:"1"},{default:s(()=>[a(V,{color:"error",icon:"",small:"",title:"刪除",onClick:t=>$(d)},{default:s(()=>[a(j,null,{default:s(()=>e[23]||(e[23]=[m("mdi-delete",-1)])),_:1,__:[23]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),a(O)]))),128)),a(V,{color:"success",onClick:q},{default:s(()=>e[24]||(e[24]=[m("＋ 新增菜單項目",-1)])),_:1,__:[24]})]),_:1,__:[25,26,27]}),a(te,null,{default:s(()=>[a(de),a(V,{color:"primary",type:"submit",variant:"elevated"},{default:s(()=>e[28]||(e[28]=[m("💾 儲存",-1)])),_:1,__:[28]})]),_:1})]),_:1})]),_:1},512))}},Te=Z(ye,[["__scopeId","data-v-b156c839"]]);export{Te as R};
