import{_ as O,ab as E,r as y,bk as J,y as R,e as v,w as u,b as W,o as i,c as o,f as c,ao as j,aj as C,ak as w,i as m,al as S,ad as z,ai as d,q as V,F,s as M,V as b,ae as G,h as H,ah as L}from"./index-AWgwsy0c.js";import{r as A}from"./restaurant-wEHn5vvw.js";import{t as h}from"./tag-Bne-C16A.js";import{V as K}from"./VContainer-DdjiTbVz.js";import{V as p,a as n}from"./VRow-DgrlSwcS.js";import{V as Q}from"./VForm-BiP2f0f4.js";import{V as X}from"./VSelect-C4kuFK5Q.js";import{V as Y}from"./VCombobox-BQXtuI6i.js";import{V as Z}from"./VFileInput-Cl5Qo54s.js";import{V as D}from"./VSwitch-XuN0X4bQ.js";import{V as ee}from"./VCheckboxBtn-DDuY08wn.js";import"./VList-Dn2VOZxI.js";import"./VDivider-DMIPa6pT.js";import"./VMenu-DoDXjbwU.js";import"./VChip-BXeRU_1z.js";import"./filter-C9uyxmCX.js";const le={class:"font-weight-bold"},ae={key:0},oe={key:1},ue={__name:"edit",setup(re){const I=J(),T=W(),_=E(),g=y(!0),k=y(!1),U=y([]),e=y({name:"",phone:"",address:"",link:"",category:"",tags:[],delivery:!1,delivery_price:0,delivery_number:0,order_time:"",sell:!0,menu:[],business_hours:[],image:[]}),x={required:r=>!!r||"此欄位為必填"},f=I.params.id,B=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];R(async()=>{try{const{data:r}=await h.getDefaultTags();r&&Array.isArray(r)?U.value=r.map(l=>l.name):(console.warn("從 API 收到的標籤資料格式不正確或為空"),U.value=[]);const{data:a}=await A.getById(f);if(a&&a.data){const l=a.data;e.value.name=l.name||"",e.value.phone=l.phone||"",e.value.address=l.address||"",e.value.link=l.link||"",e.value.category=l.category||"",e.value.delivery=l.delivery||!1,e.value.delivery_price=l.delivery_price||0,e.value.delivery_number=l.delivery_number||0,e.value.order_time=l.order_time||"",e.value.sell=l.sell??!0,e.value.tags=Array.isArray(l.tags)?l.tags.map(t=>t.name):[],e.value.menu=Array.isArray(l.menu)?l.menu.map(t=>({name:t.name,price:t.price})):[];const s=l.business_hours||[];e.value.business_hours=B.map(t=>s.find(q=>q.day===t)||{day:t,open:"",close:"",isClosed:!0})}else throw new Error("從 API 收到的餐廳資料格式不正確")}catch(r){console.error("載入餐廳資料失敗",r),_({text:"載入餐廳資料失敗",snackbarProps:{color:"error"}})}finally{g.value=!1}});const N=()=>{e.value.menu.push({name:"",price:null})},P=r=>{e.value.menu.splice(r,1)},$=async()=>{var a,l;k.value=!0;const r=new FormData;r.append("name",e.value.name),r.append("phone",e.value.phone),r.append("address",e.value.address),r.append("link",e.value.link),r.append("category",e.value.category),r.append("delivery",e.value.delivery),r.append("delivery_price",e.value.delivery_price),r.append("delivery_number",e.value.delivery_number),r.append("order_time",e.value.order_time),r.append("sell",e.value.sell),r.append("tags",JSON.stringify(e.value.tags)),r.append("menu",JSON.stringify(e.value.menu.filter(s=>s.name&&s.price>0))),r.append("business_hours",JSON.stringify(e.value.business_hours)),e.value.image&&e.value.image.length>0&&r.append("image",e.value.image[0]);try{await A.update(f,r),_({text:"餐廳更新成功",snackbarProps:{color:"success"}}),T.push(`/restaurants/${f}`)}catch(s){console.error("更新餐廳失敗",s),_({text:((l=(a=s.response)==null?void 0:a.data)==null?void 0:l.message)||"更新失敗",snackbarProps:{color:"error"}})}finally{k.value=!1}};return(r,a)=>(i(),v(K,null,{default:u(()=>[o(p,null,{default:u(()=>[o(n,{cols:"12"},{default:u(()=>a[12]||(a[12]=[c("h1",{class:"text-h4 mb-4"},"編輯餐廳",-1)])),_:1,__:[12]})]),_:1}),!g.value&&e.value.name?(i(),v(Q,{key:0,onSubmit:j($,["prevent"])},{default:u(()=>[o(p,null,{default:u(()=>[o(n,{cols:"12",md:"6"},{default:u(()=>[o(C,null,{default:u(()=>[o(w,null,{default:u(()=>a[13]||(a[13]=[m("餐廳資訊",-1)])),_:1,__:[13]}),o(S,null,{default:u(()=>[o(d,{modelValue:e.value.name,"onUpdate:modelValue":a[0]||(a[0]=l=>e.value.name=l),label:"餐廳名稱",rules:[x.required]},null,8,["modelValue","rules"]),o(d,{modelValue:e.value.phone,"onUpdate:modelValue":a[1]||(a[1]=l=>e.value.phone=l),label:"電話",rules:[x.required]},null,8,["modelValue","rules"]),o(d,{modelValue:e.value.address,"onUpdate:modelValue":a[2]||(a[2]=l=>e.value.address=l),label:"地址"},null,8,["modelValue"]),o(d,{modelValue:e.value.link,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.link=l),label:"相關連結 (例如: Google Map, Facebook)"},null,8,["modelValue"]),o(X,{modelValue:e.value.category,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.category=l),items:["食物","飲料","其他"],label:"分類",rules:[x.required]},null,8,["modelValue","rules"]),o(Y,{modelValue:e.value.tags,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.tags=l),chips:"","closable-chips":"",items:U.value,label:"標籤 (輸入後按 Enter 新增)",multiple:""},null,8,["modelValue","items"]),o(Z,{modelValue:e.value.image,"onUpdate:modelValue":a[6]||(a[6]=l=>e.value.image=l),accept:"image/*",clearable:"",label:"更換圖片"},null,8,["modelValue"]),o(D,{modelValue:e.value.delivery,"onUpdate:modelValue":a[7]||(a[7]=l=>e.value.delivery=l),color:"primary",label:"提供外送服務"},null,8,["modelValue"]),e.value.delivery?(i(),v(p,{key:0},{default:u(()=>[o(n,{cols:"6"},{default:u(()=>[o(d,{modelValue:e.value.delivery_price,"onUpdate:modelValue":a[8]||(a[8]=l=>e.value.delivery_price=l),modelModifiers:{number:!0},label:"外送最低金額",prefix:"$",type:"number"},null,8,["modelValue"])]),_:1}),o(n,{cols:"6"},{default:u(()=>[o(d,{modelValue:e.value.delivery_number,"onUpdate:modelValue":a[9]||(a[9]=l=>e.value.delivery_number=l),modelModifiers:{number:!0},label:"外送所需份數",suffix:"份",type:"number"},null,8,["modelValue"])]),_:1})]),_:1})):z("",!0),o(d,{modelValue:e.value.order_time,"onUpdate:modelValue":a[10]||(a[10]=l=>e.value.order_time=l),label:"最後點餐時間"},null,8,["modelValue"]),o(D,{modelValue:e.value.sell,"onUpdate:modelValue":a[11]||(a[11]=l=>e.value.sell=l),color:"primary",label:"上架"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(n,{cols:"12",md:"6"},{default:u(()=>[o(C,{class:"mb-4"},{default:u(()=>[o(w,null,{default:u(()=>a[14]||(a[14]=[m("菜單管理",-1)])),_:1,__:[14]}),o(S,null,{default:u(()=>[(i(!0),V(F,null,M(e.value.menu,(l,s)=>(i(),V("div",{key:`menu-${s}`,class:"d-flex align-center mb-2"},[o(d,{modelValue:l.name,"onUpdate:modelValue":t=>l.name=t,class:"mr-2",density:"compact","hide-details":"",label:"品項名稱"},null,8,["modelValue","onUpdate:modelValue"]),o(d,{modelValue:l.price,"onUpdate:modelValue":t=>l.price=t,modelModifiers:{number:!0},class:"mr-2",density:"compact","hide-details":"",label:"價格",style:{"max-width":"100px"},type:"number"},null,8,["modelValue","onUpdate:modelValue"]),o(b,{color:"error",icon:"mdi-delete",size:"small",onClick:t=>P(s)},null,8,["onClick"])]))),128)),o(b,{block:"",color:"primary",variant:"tonal",onClick:N},{default:u(()=>a[15]||(a[15]=[m("新增菜單品項",-1)])),_:1,__:[15]})]),_:1})]),_:1}),o(C,null,{default:u(()=>[o(w,null,{default:u(()=>a[16]||(a[16]=[m("營業時間",-1)])),_:1,__:[16]}),o(S,null,{default:u(()=>[(i(!0),V(F,null,M(e.value.business_hours,(l,s)=>(i(),v(p,{key:`day-${s}`,align:"center","no-gutters":""},{default:u(()=>[o(n,{cols:"2"},{default:u(()=>[c("span",le,G(l.day),1)]),_:2},1024),o(n,{cols:"4"},{default:u(()=>[o(d,{modelValue:l.open,"onUpdate:modelValue":t=>l.open=t,density:"compact",disabled:l.isClosed,"hide-details":"",label:"開店",type:"time"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024),o(n,{cols:"4"},{default:u(()=>[o(d,{modelValue:l.close,"onUpdate:modelValue":t=>l.close=t,density:"compact",disabled:l.isClosed,"hide-details":"",label:"關店",type:"time"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024),o(n,{class:"text-right",cols:"2"},{default:u(()=>[o(ee,{modelValue:l.isClosed,"onUpdate:modelValue":t=>l.isClosed=t},null,8,["modelValue","onUpdate:modelValue"]),a[17]||(a[17]=c("span",{class:"text-caption"},"休息",-1))]),_:2,__:[17]},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}),o(p,null,{default:u(()=>[o(n,{class:"text-right",cols:"12"},{default:u(()=>[o(b,{color:"success",loading:k.value,type:"submit"},{default:u(()=>a[18]||(a[18]=[m("儲存變更",-1)])),_:1,__:[18]},8,["loading"]),o(b,{class:"ml-2",color:"grey",to:`/restaurants/${H(f)}`},{default:u(()=>a[19]||(a[19]=[m("取消",-1)])),_:1,__:[19]},8,["to"])]),_:1})]),_:1})]),_:1})):(i(),v(p,{key:1},{default:u(()=>[o(n,{class:"text-center",cols:"12"},{default:u(()=>[g.value?(i(),V("div",ae,[o(L,{color:"primary",indeterminate:""}),a[20]||(a[20]=c("p",{class:"mt-2"},"載入資料中...",-1))])):(i(),V("div",oe,"找不到餐廳資料"))]),_:1})]),_:1}))]),_:1}))}},xe=O(ue,[["__scopeId","data-v-c608a20e"]]);export{xe as default};
