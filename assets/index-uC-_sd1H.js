import{_ as P,e as g,o as d,w as e,c as t,a9 as T,al as A,f as _,ae as u,i as c,q as B,ad as V,aj as U,n as j,r as $,bk as z,z as R,y as L,b as D,ai as K,bu as M,V as S,h as r,bv as E,F as H,s as O,bw as G,a8 as J}from"./index-AWgwsy0c.js";import{B as W}from"./BusinessHours-DYhOC6bX.js";import{S as X}from"./StarRating-22iEZc_-.js";import{V as k,a as v}from"./VRow-DgrlSwcS.js";import{V as Y}from"./VChip-BXeRU_1z.js";import{u as Z}from"./restaurantStore-CwzpADfS.js";import{b as w}from"./route-block-B_A1xBdJ.js";import{V as Q}from"./VContainer-DdjiTbVz.js";import{V as ee}from"./VSelect-C4kuFK5Q.js";import{V as q}from"./VAlert-tqLe5aL3.js";import{V as te}from"./VPagination-DoiRKGmI.js";import"./restaurant-wEHn5vvw.js";import"./VList-Dn2VOZxI.js";import"./VDivider-DMIPa6pT.js";import"./VMenu-DoDXjbwU.js";import"./VCheckboxBtn-DDuY08wn.js";const ae={class:"text-h6 font-weight-bold"},se={class:"ml-2"},re={class:"text-body-2"},le={key:0,class:"text-body-2"},oe={__name:"RestaurantCard",props:{restaurant:Object},emits:["click"],setup(i){return(l,o)=>(d(),g(U,{class:"hover:scale-[1.01] transition cursor-pointer",elevation:"2",hover:"",rounded:"lg",onClick:o[0]||(o[0]=p=>l.$emit("click"))},{default:e(()=>[t(T,{cover:"",height:"180",src:i.restaurant.image||"https://via.placeholder.com/300x180?text=No+Image"},null,8,["src"]),t(A,null,{default:e(()=>[t(k,{class:"justify-space-between align-center mb-2"},{default:e(()=>[t(v,{cols:"auto"},{default:e(()=>[_("div",ae,u(i.restaurant.name),1)]),_:1}),t(v,{cols:"auto"},{default:e(()=>[t(Y,{color:"#ccc",size:"small",variant:"outlined"},{default:e(()=>[c(u(i.restaurant.category||"未分類"),1)]),_:1})]),_:1})]),_:1}),t(k,{class:"align-center mb-3"},{default:e(()=>[t(v,{class:"d-flex align-center",cols:"auto"},{default:e(()=>{var p;return[t(X,{score:i.restaurant.average_score},null,8,["score"]),_("span",se,u(((p=i.restaurant.average_score)==null?void 0:p.toFixed(1))??"-"),1)]}),_:1})]),_:1}),t(k,{class:"mb-2"},{default:e(()=>[t(v,null,{default:e(()=>[_("div",re,[o[1]||(o[1]=_("strong",null,"外送狀態：",-1)),c(" "+u(i.restaurant.delivery?"有外送":"無外送"),1)]),i.restaurant.delivery?(d(),B("div",le,[o[2]||(o[2]=_("strong",null,"份數：",-1)),c("滿 "+u(i.restaurant.delivery_number)+" 個送， ",1),o[3]||(o[3]=_("strong",null,"金額：",-1)),c("滿 "+u(i.restaurant.delivery_price)+" 元送 ",1)])):V("",!0)]),_:1})]),_:1}),t(W,{hours:i.restaurant.business_hours},null,8,["hours"])]),_:1})]),_:1}))}},ne=P(oe,[["__scopeId","data-v-413784ee"]]),ue={key:0},x=9,ie={__name:"index",setup(i){const l=Z(),o=z(),p=D(),C=j(),f=$(o.query.q||""),m=$(o.query.category||""),y=$(Number.parseInt(o.query.page)||1),F=["食物","飲料","其他"];function N(){const n={};f.value&&f.value.trim()&&(n.q=f.value.trim()),m.value&&m.value.trim()&&(n.category=m.value.trim()),y.value>1&&(n.page=y.value),p.push({query:n})}function b(){y.value===1?N():(y.value=1,J(()=>{N()}))}R(()=>o.query,n=>{console.log("前端/pages/restaurants/index.vue 路由查詢參數變化:",n);const a=n.q||"",s=n.category||"",h=Number.parseInt(n.page)||1;console.log("前端/pages/restaurants/index.vue 解析後的參數:",{searchParam:a,categoryParam:s,pageParam:h}),console.log("前端/pages/restaurants/index.vue fetchAll 傳入的參數",{search:a,category:s,page:h,limit:x}),l.fetchAll({search:a,category:s,page:h,limit:x})},{immediate:!0}),R(m,()=>{b()}),L(()=>{console.log("前端/pages/restaurants/index.vue 頁面載入完成")});function I(n){p.push(`/restaurants/${n}`)}return(n,a)=>(d(),g(Q,null,{default:e(()=>[t(k,{align:"center",class:"mt-15"},{default:e(()=>[t(v,{cols:"12",md:"4"},{default:e(()=>[t(K,{modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=s=>f.value=s),clearable:"",dense:"","hide-details":"",label:"搜尋餐廳","prepend-icon":"mdi-magnify","onClick:clear":b,onKeyup:M(b,["enter"])},null,8,["modelValue"])]),_:1}),t(v,{cols:"12",md:"4"},{default:e(()=>[t(ee,{modelValue:m.value,"onUpdate:modelValue":a[1]||(a[1]=s=>m.value=s),clearable:"",dense:"","hide-details":"",items:F,label:"分類",onChange:b},null,8,["modelValue"])]),_:1}),t(v,{class:"text-right",cols:"12",md:"4"},{default:e(()=>[t(S,{class:"ml-auto",color:"#CFB53B","prepend-icon":"mdi-plus",size:"x-large",transparent:"",variant:"outlined",onClick:a[2]||(a[2]=s=>r(p).push("/restaurants/create"))},{default:e(()=>a[4]||(a[4]=[c(" 新增餐廳 ",-1)])),_:1,__:[4]})]),_:1})]),_:1}),r(l).loading?(d(),g(E,{key:0,class:"mb-4",indeterminate:""})):V("",!0),r(l).error?(d(),g(q,{key:1,type:"error"},{default:e(()=>[c(" 發生錯誤："+u(r(l).error.message),1)]),_:1})):V("",!0),r(l).restaurants.length===0&&!r(l).loading?(d(),g(q,{key:2,type:"info"},{default:e(()=>a[5]||(a[5]=[c(" 目前沒有找到餐廳資料 ",-1)])),_:1,__:[5]})):V("",!0),r(l).restaurants.length>0&&!r(l).loading?(d(),g(q,{key:3,class:"mb-3",variant:"plain"},{default:e(()=>[c(" 找到 "+u(r(l).total)+" 間餐廳，目前顯示第 "+u(y.value)+" 頁（每頁 "+u(x)+" 間） ",1),f.value||m.value?(d(),B("div",ue," 搜尋條件："+u(f.value?`關鍵字「${f.value}」`:"")+u(m.value?`分類「${m.value}」`:""),1)):V("",!0)]),_:1})):V("",!0),t(k,null,{default:e(()=>[(d(!0),B(H,null,O(r(l).restaurants,s=>(d(),g(v,{key:s._id,cols:"12",md:"4",sm:"6"},{default:e(()=>[t(ne,{restaurant:s,onClick:h=>I(s._id)},G({_:2},[r(C).isLoggedIn&&(r(C).isAdmin||r(C)._id===s.owner)?{name:"actions",fn:e(()=>[t(S,{color:"primary",to:`/restaurants/edit/${s._id}`,variant:"text"},{default:e(()=>a[6]||(a[6]=[c(" 編輯 ",-1)])),_:2,__:[6]},1032,["to"])]),key:"0"}:void 0]),1032,["restaurant","onClick"])]),_:2},1024))),128))]),_:1}),r(l).total>x?(d(),g(te,{key:4,modelValue:y.value,"onUpdate:modelValue":[a[3]||(a[3]=s=>y.value=s),b],class:"mt-6",length:Math.ceil(r(l).total/x)},null,8,["modelValue","length"])):V("",!0)]),_:1}))}};typeof w=="function"&&w(ie);export{ie as default};
