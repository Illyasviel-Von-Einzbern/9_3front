import{aV as ie,n as J,ab as K,am as O,r as v,v as U,y as de,z as ce,e as d,w as l,bk as me,b as fe,o,c as t,ad as p,V as _,i as u,h as ve,ah as pe,aj as z,q as k,a9 as F,al as R,f as n,ae as c,ac as M,F as h,ak as $,s as N,af as ge,an as ye,ai as _e,ap as ke,j as Ve}from"./index-CIHyU37z.js";import{B as be}from"./BusinessHours-BV13ZfNd.js";import{S as we}from"./StarRating-DlK_bLI7.js";import{r as P}from"./review-DWVG1XrH.js";import{V as xe}from"./VContainer-Czllfyk0.js";import{V as H,a as V}from"./VRow-BQerUWQv.js";import{V as W}from"./VChip-Crq8nVJ7.js";import{V as b}from"./VDivider-3u-8eSsr.js";import{V as E,a as G,b as Ie,c as Se}from"./VList-CdzutsXp.js";import{V as Y}from"./VRating-BrMA7glR.js";import{V as Ce}from"./VTextarea-d6ZWnqqs.js";import{V as Ae}from"./VCheckbox-Bq7NSs5r.js";import"./VCheckboxBtn-BFND6HbK.js";const he=ie("cart",()=>{const j=J(),g=K();return{addItem:async m=>{var L,f;if(!j.isLoggedIn)return g({text:"請先登入",snackbarProps:{color:"error"}}),!1;try{return await O.apiAuth.post("/orders",{restaurantId:m.restaurantId,items:[{menuItemId:m._id,quantity:m.quantity}]}),g({text:`已將 ${m.name} 加入訂單`,snackbarProps:{color:"success"}}),!0}catch(r){return console.error("加入訂單失敗",r),g({text:((f=(L=r.response)==null?void 0:L.data)==null?void 0:f.message)||"加入訂單失敗",snackbarProps:{color:"error"}}),!1}}}}),Le={class:"d-flex justify-space-between align-center mb-2"},Re={class:"text-h5 font-weight-bold"},$e={class:"d-flex align-center mb-4"},Pe={class:"ml-2 text-body-1"},De={key:0},Te=["href"],Be={class:"d-flex align-center",style:{"font-size":"0.9rem",color:"#fff"}},Ue={class:"font-weight-medium"},ze={style:{"font-size":"1rem","margin-top":"4px"}},Fe={class:"text-h5"},Xe={__name:"[id]",setup(j){const g=me(),q=fe(),m=K(),L=he(),f=J(),r=v(null),D=v(!0),w=v(!1),y=v(null),x=v(1),Q=s=>{y.value={...s},x.value=1,w.value=!0},X=async()=>{if(!y.value||x.value<=0)return;const s=await L.addItem({...y.value,quantity:x.value,restaurantId:r.value._id});w.value=!1,s&&q.push("/orders")},Z=U(()=>{var e;if(!((e=r.value)!=null&&e.link))return"#";const s=r.value.link;return s.startsWith("http://")||s.startsWith("https://")?s:`https://${s}`}),ee=U(()=>{var e;if(!((e=r.value)!=null&&e.link))return"";const s=r.value.link.toLowerCase();return s.includes("google.com/maps")?"Google 地圖":s.includes("facebook.com")?"Facebook":s.includes("instagram.com")?"Instagram":s.includes("line.me")?"Line":"官方網站"}),ae=U(()=>{var e;if(!((e=r.value)!=null&&e.link))return null;const s=r.value.link.toLowerCase();return s.includes("google.com/maps")?"mdi-google-maps":s.includes("facebook.com")?"mdi-facebook":s.includes("instagram.com")?"mdi-instagram":s.includes("line.me")?"mdi-chat":"mdi-link-variant"}),T=async()=>{var s,e;D.value=!0;try{const{data:a}=await O.apiAuth.get("/restaurants/"+g.params.id);r.value=a.data,console.log(S)}catch(a){console.error("無法載入餐廳資料",a),m({text:((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"無法載入餐廳資料",snackbarProps:{color:"error"}}),r.value=null}finally{D.value=!1}},i=v({content:"",score:0,isAnonymous:!1}),I=v(null),te=async()=>{var s,e;if(!f.isLoggedIn)return m({text:"請先登入才能留言",snackbarProps:{color:"warning"}});if(!i.value.content)return m({text:"請填寫評論內容與評分",snackbarProps:{color:"error"}});try{I.value?(await P.update(I.value,{content:i.value.content,score:i.value.score,isAnonymous:i.value.isAnonymous}),m({text:"評論修改成功",snackbarProps:{color:"success"}})):(await P.create(r.value._id,{content:i.value.content,score:i.value.score,isAnonymous:i.value.isAnonymous}),m({text:"評論送出成功",snackbarProps:{color:"success"}})),i.value={content:"",score:0,isAnonymous:!1},I.value=null,await B()}catch(a){console.error("送出評論失敗",a),m({text:((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"評論送出失敗，請稍後再試",snackbarProps:{color:"error"}})}},le=async()=>{var s,e;if(f.isLoggedIn)try{const{data:a}=await P.getUserReview(r.value._id);a.review&&(I.value=a.review._id,i.value.content=a.review.content,i.value.score=a.review.score,i.value.isAnonymous=a.review.isAnonymous??!1)}catch(a){console.log("使用者尚未評論或錯誤：",(e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)}},S=v([]),se=async()=>{var s;if((s=r.value)!=null&&s._id)try{const e=await P.getByRestaurant(r.value._id);S.value=e.data.result}catch(e){console.error("載入評論失敗",e)}},B=async()=>{await T(),await le(),await se()};function re(s){const e=new Date(s),a=e.getFullYear(),C=String(e.getMonth()+1).padStart(2,"0"),A=String(e.getDate()).padStart(2,"0"),ne=String(e.getHours()).padStart(2,"0"),oe=String(e.getMinutes()).padStart(2,"0"),ue=String(e.getSeconds()).padStart(2,"0");return`${a}／${C}／${A}　${ne}：${oe}：${ue}`}return de(async()=>{f.isLoggedIn?await B():await T()}),ce(()=>g.params.id,async s=>{s&&(f.isLoggedIn?await B():await T())}),(s,e)=>(o(),d(xe,null,{default:l(()=>[t(H,null,{default:l(()=>[t(V,{class:"d-flex justify-space-between align-center",cols:"12"},{default:l(()=>[t(_,{"prepend-icon":"mdi-arrow-left",to:"/"},{default:l(()=>e[6]||(e[6]=[u("返回列表",-1)])),_:1,__:[6]}),r.value&&ve(f).isLoggedIn?(o(),d(_,{key:0,color:"primary","prepend-icon":"mdi-pencil",to:`/restaurants/edit/${r.value._id}`},{default:l(()=>e[7]||(e[7]=[u(" 編輯餐廳 ",-1)])),_:1,__:[7]},8,["to"])):p("",!0)]),_:1}),D.value?(o(),d(V,{key:0,class:"text-center",cols:"12"},{default:l(()=>[t(pe,{color:"primary",indeterminate:""})]),_:1})):r.value?(o(),d(V,{key:1,cols:"12"},{default:l(()=>[t(z,null,{default:l(()=>[t(F,{cover:"",height:"500px",src:r.value.image},null,8,["src"]),t(R,null,{default:l(()=>[n("div",Le,[n("div",Re,c(r.value.name),1),t(W,{color:"primary",size:"small",variant:"outlined"},{default:l(()=>[u(c(r.value.category||"未分類"),1)]),_:1})]),n("div",$e,[t(we,{score:r.value.average_score},null,8,["score"]),n("span",Pe,c(r.value.average_score.toFixed(1)),1)]),n("p",null,[e[8]||(e[8]=n("strong",null,"電話：",-1)),u(" "+c(r.value.phone),1)]),n("p",null,[e[9]||(e[9]=n("strong",null,"地址：",-1)),u(" "+c(r.value.address),1)]),r.value.link?(o(),k("p",De,[e[10]||(e[10]=n("strong",null,"相關連結：",-1)),n("a",{class:"d-inline-flex align-center",href:Z.value,rel:"noopener noreferrer",style:{"text-decoration":"none",color:"inherit"},target:"_blank"},[t(M,{class:"mr-1",icon:ae.value,size:"small"},null,8,["icon"]),u(" "+c(ee.value),1)],8,Te)])):p("",!0),e[11]||(e[11]=n("p",null,[n("strong",null,"營業時間：")],-1)),t(be,{hours:r.value.business_hours},null,8,["hours"])]),_:1,__:[11]}),t(b),r.value.menuImage?(o(),k(h,{key:0},[t($,null,{default:l(()=>e[12]||(e[12]=[u("店家菜單",-1)])),_:1,__:[12]}),t(F,{class:"mx-4 mb-4","max-height":"600",src:r.value.menuImage,style:{border:"1px solid #eee","border-radius":"4px"}},null,8,["src"]),t(b)],64)):p("",!0),t($,null,{default:l(()=>e[13]||(e[13]=[u("餐點介紹",-1)])),_:1,__:[13]}),r.value.menu&&r.value.menu.length>0?(o(),d(E,{key:1},{default:l(()=>[(o(!0),k(h,null,N(r.value.menu,(a,C)=>(o(),k(h,{key:a._id},[t(G,null,{prepend:l(()=>[t(ge,{class:"mr-4",rounded:"lg"},{default:l(()=>[a.image?(o(),d(F,{key:0,alt:a.name,cover:"",src:a.image},null,8,["alt","src"])):(o(),d(M,{key:1},{default:l(()=>e[14]||(e[14]=[u("mdi-food-outline",-1)])),_:1,__:[14]}))]),_:2},1024)]),append:l(()=>[t(_,{color:"primary",size:"small",variant:"tonal",onClick:A=>Q(a)},{default:l(()=>e[15]||(e[15]=[u("加入訂單",-1)])),_:2,__:[15]},1032,["onClick"])]),default:l(()=>[t(Ie,null,{default:l(()=>[u(c(a.name),1)]),_:2},1024),t(Se,null,{default:l(()=>[u("$"+c(a.price),1)]),_:2},1024)]),_:2},1024),C<r.value.menu.length-1?(o(),d(b,{key:0})):p("",!0)],64))),128))]),_:1})):(o(),d(R,{key:2},{default:l(()=>e[16]||(e[16]=[u(" 店家尚未提供菜單 ",-1)])),_:1,__:[16]})),t(b),S.value.length>0?(o(),d(E,{key:3,style:{"overflow-x":"hidden"}},{default:l(()=>[(o(!0),k(h,null,N(S.value,(a,C)=>(o(),k(h,{key:a._id},[t(G,null,{default:l(()=>[t(H,{align:"center",class:"w-100","no-gutters":""},{default:l(()=>[t(V,{cols:"7"},{default:l(()=>{var A;return[n("div",Be,[n("span",Ue,c(a.isAnonymous?"匿名使用者":((A=a.user)==null?void 0:A.account)||"使用者"),1),e[18]||(e[18]=n("span",null,"　　",-1)),n("span",null,c(re(a.createdAt)),1),a.isDeleted?(o(),d(W,{key:0,class:"ml-2",color:"error",size:"x-small",variant:"outlined"},{default:l(()=>e[17]||(e[17]=[u(" 已刪除 ",-1)])),_:1,__:[17]})):p("",!0)]),n("div",ze,c(a.content),1)]}),_:2},1024),t(V,{class:"d-flex justify-end",cols:"5"},{default:l(()=>[t(Y,{color:"amber",density:"compact","half-increments":"","model-value":a.score,readonly:""},null,8,["model-value"])]),_:2},1024)]),_:2},1024)]),_:2},1024),C<S.value.length-1?(o(),d(b,{key:0})):p("",!0)],64))),128))]),_:1})):p("",!0)]),_:1})]),_:1})):(o(),d(V,{key:2,class:"text-center",cols:"12"},{default:l(()=>e[19]||(e[19]=[n("h2",null,"找不到餐廳",-1),n("p",null,"您要找的餐廳可能不存在或已被移除。",-1)])),_:1,__:[19]}))]),_:1}),t(ye,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=a=>w.value=a),"max-width":"500px"},{default:l(()=>[y.value?(o(),d(z,{key:0},{default:l(()=>[t($,null,{default:l(()=>[n("span",Fe,c(y.value.name),1)]),_:1}),t(R,null,{default:l(()=>[n("p",null,"價格: $"+c(y.value.price),1),t(_e,{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=a=>x.value=a),modelModifiers:{number:!0},class:"mt-4",density:"compact","hide-details":"",label:"數量",min:"1",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(ke,null,{default:l(()=>[t(Ve),t(_,{color:"blue-darken-1",text:"",onClick:e[1]||(e[1]=a=>w.value=!1)},{default:l(()=>e[20]||(e[20]=[u("取消",-1)])),_:1,__:[20]}),t(_,{color:"blue-darken-1",variant:"tonal",onClick:X},{default:l(()=>e[21]||(e[21]=[u("確認加入",-1)])),_:1,__:[21]})]),_:1})]),_:1})):p("",!0)]),_:1},8,["modelValue"]),t(b,{class:"my-8"}),t(z,{class:"pa-4",elevation:"2"},{default:l(()=>[t($,null,{default:l(()=>e[22]||(e[22]=[u("📝 我要留言",-1)])),_:1,__:[22]}),t(R,null,{default:l(()=>[t(Ce,{modelValue:i.value.content,"onUpdate:modelValue":e[3]||(e[3]=a=>i.value.content=a),"auto-grow":"",clearable:"",counter:"300",label:"評論內容",rows:"3",rules:[a=>!!a||"請輸入評論內容"]},null,8,["modelValue","rules"]),t(Y,{modelValue:i.value.score,"onUpdate:modelValue":e[4]||(e[4]=a=>i.value.score=a),"background-color":"grey lighten-1",class:"mt-2",color:"amber",label:"評分",large:"",length:"5"},null,8,["modelValue"]),t(Ae,{modelValue:i.value.isAnonymous,"onUpdate:modelValue":e[5]||(e[5]=a=>i.value.isAnonymous=a),class:"mt-2",label:"匿名留言"},null,8,["modelValue"]),t(_,{class:"mt-4",color:"primary",onClick:te},{default:l(()=>[u(c(I.value?"修改評論":"送出評論"),1)]),_:1})]),_:1})]),_:1})]),_:1}))}};export{Xe as default};
