import{ab as B,n as I,r as L,v as m,e as _,w as e,ag as v,b as N,d as P,o as c,c as r,f as V,q as k,F as y,s as T,ad as D,i as u,ae as d,af as U,a9 as F,V as R}from"./index-AWgwsy0c.js";import{o as $}from"./order-Dq5cgiZr.js";import{b}from"./route-block-B_A1xBdJ.js";import{V as A}from"./VContainer-DdjiTbVz.js";import{V as E,a as i}from"./VRow-DgrlSwcS.js";import{V as C}from"./VDivider-DMIPa6pT.js";import{V as j,a as z,b as G,c as H}from"./VList-Dn2VOZxI.js";import{V as J}from"./VNumberInput-CXyhXVaH.js";const K={class:"text-center"},M={__name:"cart",setup(O){const l=B(),p=I(),x=N(),s=L([]);(async()=>{try{const{data:t}=await v.getCart();s.value=t.result}catch(t){console.error(t),l({text:"無法獲取購物車資料",snackbarProps:{color:"red"}})}})();const g=async(t,o,n)=>{try{const{data:a}=await v.cart({product:o.product._id,quantity:t-o.quantity});o.quantity=t,t<=0&&s.value.splice(n,1),p.cartTotal=a.result}catch(a){console.error(a),l({text:"更新購物車失敗",snackbarProps:{color:"red"}})}},h=m(()=>s.value.reduce((t,o)=>t+o.product.price*o.quantity,0)),q=m(()=>s.value.length===0||s.value.some(t=>!t.product.sell)),w=async()=>{try{await $.create(),p.cartTotal=0,x.push("/orders")}catch(t){console.error(t),l({text:"結帳失敗",snackbarProps:{color:"red"}})}};return(t,o)=>{const n=P("router-link");return c(),_(A,null,{default:e(()=>[r(E,null,{default:e(()=>[r(i,{cols:"12"},{default:e(()=>o[0]||(o[0]=[V("h1",{class:"text-center"},"購物車",-1)])),_:1,__:[0]}),r(C),r(i,{cols:"12"},{default:e(()=>[r(j,{lines:"two"},{default:e(()=>[(c(!0),k(y,null,T(s.value,(a,S)=>(c(),k(y,{key:a._id},[r(z,{active:!a.product.sell,color:"red"},{prepend:e(()=>[r(U,{class:"cursor-pointer",rounded:"0",onClick:f=>t.$router.push("/product/"+a.product._id)},{default:e(()=>[r(F,{src:a.product.image},null,8,["src"])]),_:2},1032,["onClick"])]),append:e(()=>[r(J,{"control-variant":"split",min:0,"model-value":a.quantity,variant:"outlined",width:"150px","onUpdate:modelValue":f=>g(f,a,t.index)},null,8,["model-value","onUpdate:modelValue"])]),default:e(()=>[r(G,null,{default:e(()=>[r(n,{class:"text-decoration-none text-primary",to:"/product/"+a.product._id},{default:e(()=>[u(d(a.product.name),1)]),_:2},1032,["to"])]),_:2},1024),r(H,null,{default:e(()=>[u(" 價格： "+d(a.product.price)+" 元 ",1)]),_:2},1024)]),_:2},1032,["active"]),S<s.value.length-1?(c(),_(C,{key:0})):D("",!0)],64))),128))]),_:1})]),_:1}),r(i,{cols:"12"},{default:e(()=>[V("p",K,"總金額： "+d(h.value),1),r(R,{color:"primary",disabled:q.value,onClick:w},{default:e(()=>o[1]||(o[1]=[u("結帳",-1)])),_:1,__:[1]},8,["disabled"])]),_:1})]),_:1})]),_:1})}}};typeof b=="function"&&b(M);export{M as default};
