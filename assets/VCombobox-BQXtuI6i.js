import{u as Ie,m as Fe,a as De}from"./VSelect-C4kuFK5Q.js";import{g as Pe,p as Re,aw as Ae,r as N,t as F,aH as Te,P as Q,b1 as Ee,bl as Me,v as p,a8 as $,T as _e,z as D,b9 as Z,u as Ne,ai as ee,c as d,m as S,aI as Le,bU as Be,aJ as Ke,bm as Oe,bV as Ue,bW as le,bS as ze,f as I,ac as ae,bX as $e,F as H,af as He,bY as je,as as qe,at as We,aa as Je,i as Xe}from"./index-AWgwsy0c.js";import{u as Ye,m as Ge,h as Qe}from"./filter-C9uyxmCX.js";import{u as Ze,t as P,V as el,a as te,d as ll}from"./VList-Dn2VOZxI.js";import{V as al}from"./VMenu-DoDXjbwU.js";import{V as tl}from"./VDivider-DMIPa6pT.js";import{V as ul}from"./VCheckboxBtn-DDuY08wn.js";import{V as nl}from"./VChip-BXeRU_1z.js";const ol=Re({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...Ge({filterKeys:["title"]}),...Fe({hideNoData:!0,returnObject:!0}),...Ke(Oe({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...Be({transition:!1})},"VCombobox"),hl=Pe()({name:"VCombobox",props:ol(),emits:{"update:focused":l=>!0,"update:modelValue":l=>!0,"update:search":l=>!0,"update:menu":l=>!0},setup(l,ue){var W;let{emit:ne,slots:n}=ue;const{t:L}=Ae(),b=N(),x=F(!1),k=F(!0),B=F(!1),j=N(),R=N(),s=F(-1);let K=!1;const{items:oe,transformIn:ie,transformOut:se}=Ze(l),{textColorClasses:re,textColorStyles:ce}=Te(()=>{var e;return(e=b.value)==null?void 0:e.color}),o=Q(l,"modelValue",[],e=>ie(Ee(e)),e=>{const a=se(e);return l.multiple?a:a[0]??null}),A=Me(l),T=p(()=>!!(l.chips||n.chip)),y=p(()=>T.value||!!n.selection),C=F(!l.multiple&&!y.value?((W=o.value[0])==null?void 0:W.title)??"":""),v=p({get:()=>C.value,set:e=>{var a;if(C.value=e??"",!l.multiple&&!y.value&&(o.value=[P(l,e)],$(()=>{var i;return(i=R.value)==null?void 0:i.scrollToIndex(0)})),e&&l.multiple&&((a=l.delimiters)!=null&&a.length)){const i=e.split(new RegExp(`(?:${l.delimiters.join("|")})+`));i.length>1&&(i.forEach(t=>{t=t.trim(),t&&g(P(l,t))}),C.value="")}e||(s.value=-1),k.value=!e}}),ve=p(()=>typeof l.counterValue=="function"?l.counterValue(o.value):typeof l.counterValue=="number"?l.counterValue:l.multiple?o.value.length:v.value.length),{filteredItems:E,getMatches:de}=Ye(l,oe,()=>k.value?"":v.value),w=p(()=>l.hideSelected?E.value.filter(e=>!o.value.some(a=>a.value===e.value)):E.value),M=p(()=>l.hideNoData&&!w.value.length||A.isReadonly.value||A.isDisabled.value),O=Q(l,"menu"),r=p({get:()=>O.value,set:e=>{var a;O.value&&!e&&((a=j.value)!=null&&a.Î¨openChildren.size)||e&&M.value||(O.value=e)}}),q=_e(()=>r.value?l.closeText:l.openText);D(C,e=>{K?$(()=>K=!1):x.value&&!r.value&&(r.value=!0),ne("update:search",e)}),D(o,e=>{var a;!l.multiple&&!y.value&&(C.value=((a=e[0])==null?void 0:a.title)??"")});const fe=p(()=>o.value.map(e=>e.value)),U=p(()=>{var a;return(l.autoSelectFirst===!0||l.autoSelectFirst==="exact"&&v.value===((a=w.value[0])==null?void 0:a.title))&&w.value.length>0&&!k.value&&!B.value}),z=N(),me=Ie(z,b);function he(e){K=!0,l.openOnClear&&(r.value=!0)}function be(){M.value||(r.value=!0)}function ge(e){M.value||(x.value&&(e.preventDefault(),e.stopPropagation()),r.value=!r.value)}function Ve(e){var a;(le(e)||e.key==="Backspace")&&((a=b.value)==null||a.focus())}function xe(e){var t,c,f,V;if(Ue(e)||A.isReadonly.value)return;const a=(t=b.value)==null?void 0:t.selectionStart,i=o.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(e.key)&&e.preventDefault(),["Enter","ArrowDown"].includes(e.key)&&(r.value=!0),["Escape"].includes(e.key)&&(r.value=!1),["Enter","Escape","Tab"].includes(e.key)&&(U.value&&["Enter","Tab"].includes(e.key)&&!o.value.some(u=>{let{value:h}=u;return h===w.value[0].value})&&g(E.value[0]),k.value=!0),e.key==="ArrowDown"&&U.value&&((c=z.value)==null||c.focus("next")),e.key==="Enter"&&v.value&&(g(P(l,v.value)),y.value&&(C.value="")),["Backspace","Delete"].includes(e.key)){if(!l.multiple&&y.value&&o.value.length>0&&!v.value)return g(o.value[0],!1);if(~s.value){e.preventDefault();const u=s.value;g(o.value[s.value],!1),s.value=u>=i-1?i-2:u}else e.key==="Backspace"&&!v.value&&(s.value=i-1);return}if(l.multiple)if(e.key==="ArrowLeft"){if(s.value<0&&a&&a>0)return;const u=s.value>-1?s.value-1:i-1;o.value[u]?s.value=u:(s.value=-1,(f=b.value)==null||f.setSelectionRange(v.value.length,v.value.length))}else if(e.key==="ArrowRight"){if(s.value<0)return;const u=s.value+1;o.value[u]?s.value=u:(s.value=-1,(V=b.value)==null||V.setSelectionRange(0,0))}else~s.value&&le(e)&&(s.value=-1)}function ye(){var e;l.eager&&((e=R.value)==null||e.calculateVisibleItems())}function pe(){var e;x.value&&(k.value=!0,(e=b.value)==null||e.focus())}function g(e){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!e||e.props.disabled))if(l.multiple){const i=o.value.findIndex(c=>(l.valueComparator||Z)(c.value,e.value)),t=a??!~i;if(~i){const c=t?[...o.value,e]:[...o.value];c.splice(i,1),o.value=c}else t&&(o.value=[...o.value,e]);l.clearOnSelect&&(v.value="")}else{const i=a!==!1;o.value=i?[e]:[],C.value=i&&!y.value?e.title:"",$(()=>{r.value=!1,k.value=!0})}}function ke(e){x.value=!0,setTimeout(()=>{B.value=!0})}function Ce(e){B.value=!1}function we(e){(e==null||e===""&&!l.multiple&&!y.value)&&(o.value=[])}return D(x,(e,a)=>{if(!(e||e===a)&&(s.value=-1,r.value=!1,v.value)){if(l.multiple){g(P(l,v.value));return}if(!y.value)return;o.value.some(i=>{let{title:t}=i;return t===v.value})?C.value="":g(P(l,v.value))}}),D(r,()=>{if(!l.hideSelected&&r.value&&o.value.length){const e=w.value.findIndex(a=>o.value.some(i=>(l.valueComparator||Z)(i.value,a.value)));ze&&window.requestAnimationFrame(()=>{var a;e>=0&&((a=R.value)==null||a.scrollToIndex(e))})}}),D(()=>l.items,(e,a)=>{r.value||x.value&&!a.length&&e.length&&(r.value=!0)}),Ne(()=>{const e=!!(!l.hideNoData||w.value.length||n["prepend-item"]||n["append-item"]||n["no-data"]),a=o.value.length>0,i=ee.filterProps(l);return d(ee,S({ref:b},i,{modelValue:v.value,"onUpdate:modelValue":[t=>v.value=t,we],focused:x.value,"onUpdate:focused":t=>x.value=t,validationValue:o.externalValue,counterValue:ve.value,dirty:a,class:["v-combobox",{"v-combobox--active-menu":r.value,"v-combobox--chips":!!l.chips,"v-combobox--selection-slot":!!y.value,"v-combobox--selecting-index":s.value>-1,[`v-combobox--${l.multiple?"multiple":"single"}`]:!0},l.class],style:l.style,readonly:A.isReadonly.value,placeholder:a?void 0:l.placeholder,"onClick:clear":he,"onMousedown:control":be,onKeydown:xe}),{...n,default:()=>I(H,null,[d(al,S({ref:j,modelValue:r.value,"onUpdate:modelValue":t=>r.value=t,activator:"parent",contentClass:"v-combobox__content",disabled:M.value,eager:l.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:l.transition,onAfterEnter:ye,onAfterLeave:pe},l.menuProps),{default:()=>[e&&d(el,S({ref:z,filterable:!0,selected:fe.value,selectStrategy:l.multiple?"independent":"single-independent",onMousedown:t=>t.preventDefault(),onKeydown:Ve,onFocusin:ke,onFocusout:Ce,tabindex:"-1","aria-live":"polite",color:l.itemColor??l.color},me,l.listProps),{default:()=>{var t,c,f;return[(t=n["prepend-item"])==null?void 0:t.call(n),!w.value.length&&!l.hideNoData&&(((c=n["no-data"])==null?void 0:c.call(n))??d(te,{key:"no-data",title:L(l.noDataText)},null)),d(De,{ref:R,renderless:!0,items:w.value,itemKey:"value"},{default:V=>{var X,Y,G;let{item:u,index:h,itemRef:m}=V;const J=S(u.props,{ref:m,key:u.value,active:U.value&&h===0?!0:void 0,onClick:()=>g(u,null)});return u.type==="divider"?((X=n.divider)==null?void 0:X.call(n,{props:u.raw,index:h}))??d(tl,S(u.props,{key:`divider-${h}`}),null):u.type==="subheader"?((Y=n.subheader)==null?void 0:Y.call(n,{props:u.raw,index:h}))??d(ll,S(u.props,{key:`subheader-${h}`}),null):((G=n.item)==null?void 0:G.call(n,{item:u,index:h,props:J}))??d(te,S(J,{role:"option"}),{prepend:_=>{let{isSelected:Se}=_;return I(H,null,[l.multiple&&!l.hideSelected?d(ul,{key:u.value,modelValue:Se,ripple:!1,tabindex:"-1"},null):void 0,u.props.prependAvatar&&d(He,{image:u.props.prependAvatar},null),u.props.prependIcon&&d(ae,{icon:u.props.prependIcon},null)])},title:()=>{var _;return k.value?u.title:Qe("v-combobox",u.title,(_=de(u))==null?void 0:_.title)}})}}),(f=n["append-item"])==null?void 0:f.call(n)]}})]}),o.value.map((t,c)=>{function f(m){m.stopPropagation(),m.preventDefault(),g(t,!1)}const V={"onClick:close":f,onKeydown(m){m.key!=="Enter"&&m.key!==" "||(m.preventDefault(),m.stopPropagation(),f(m))},onMousedown(m){m.preventDefault(),m.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},u=T.value?!!n.chip:!!n.selection,h=u?je(T.value?n.chip({item:t,index:c,props:V}):n.selection({item:t,index:c})):void 0;if(!(u&&!h))return I("div",{key:t.value,class:We(["v-combobox__selection",c===s.value&&["v-combobox__selection--selected",re.value]]),style:qe(c===s.value?ce.value:{})},[T.value?n.chip?d(Je,{key:"chip-defaults",defaults:{VChip:{closable:l.closableChips,size:"small",text:t.title}}},{default:()=>[h]}):d(nl,S({key:"chip",closable:l.closableChips,size:"small",text:t.title,disabled:t.props.disabled},V),null):h??I("span",{class:"v-combobox__selection-text"},[t.title,l.multiple&&c<o.value.length-1&&I("span",{class:"v-combobox__selection-comma"},[Xe(",")])])])})]),"append-inner":function(){var V,u;for(var t=arguments.length,c=new Array(t),f=0;f<t;f++)c[f]=arguments[f];return I(H,null,[(V=n["append-inner"])==null?void 0:V.call(n,...c),(!l.hideNoData||l.items.length)&&l.menuIcon?d(ae,{class:"v-combobox__menu-icon",color:(u=b.value)==null?void 0:u.fieldIconColor,icon:l.menuIcon,onMousedown:ge,onClick:$e,"aria-label":L(q.value),title:L(q.value),tabindex:"-1"},null):void 0])}})}),Le({isFocused:x,isPristine:k,menu:r,search:v,selectionIndex:s,filteredItems:E,select:g},b)}});export{hl as V};
