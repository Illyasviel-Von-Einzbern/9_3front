import{ab as z,r as u,aq as L,q as O,c as l,w as o,an as K,F as G,d as H,o as h,f as w,V as y,e as J,ad as Q,ac as W,a9 as X,i as b,j as Y,ai as C,ao as Z,h as r,aj as ee,ak as ae,ae as q,al as le,ap as te}from"./index-CIHyU37z.js";import{u as re,c as oe,e as se,a as A,b as ie,d as m}from"./index.esm-DXda4eDn.js";import{p as _}from"./product-D7nYa-s6.js";import{b as P}from"./route-block-B_A1xBdJ.js";import{V as ne}from"./VContainer-Czllfyk0.js";import{V as de,a as $}from"./VRow-BQerUWQv.js";import{V as ue}from"./VDivider-3u-8eSsr.js";import{V as me}from"./VDataTable-f5nkd4zz.js";import{a as pe}from"./VToolbar-NoXfre1x.js";import{V as ce}from"./VForm-CGGqa3P4.js";import{V as ve}from"./VSelect-CxX8EwAn.js";import{V as ge}from"./VTextarea-d6ZWnqqs.js";import{V as fe}from"./VCheckbox-Bq7NSs5r.js";import"./VPagination-CLol_7gt.js";import"./VCheckboxBtn-BFND6HbK.js";import"./VChip-Crq8nVJ7.js";import"./filter-BW8gkpM9.js";import"./VList-CdzutsXp.js";import"./VMenu-D_8JceEl.js";const Ve={class:"px-4"},ye={class:"px-4"},be={__name:"products",setup(ke){const d=z(),F=u([]),k=u(""),R=[{title:"ID",key:"_id"},{title:"圖片",key:"image",sortable:!1},{title:"名稱",key:"name"},{title:"分類",key:"category"},{title:"價格",key:"price"},{title:"描述",key:"description"},{title:"上架",key:"sell"},{title:"建立日期",key:"createdAt",value:t=>new Date(t.createdAt).toLocaleString()},{title:"更新日期",key:"updatedAt",value:t=>new Date(t.updatedAt).toLocaleString()},{title:"操作",key:"action",sortable:!1}],N=["_id","name","category","price","description","createdAt","updatedAt"],S=async()=>{try{const{data:t}=await _.getAll();F.value=t.products}catch(t){console.error("Error fetching products:",t),d({text:"無法載入商品資料",snackbarProps:{color:"red"}})}};S();const D=L("fileAgent"),i=u({open:!1,id:""}),M=t=>{t&&(i.value.id=t._id,p.value.value=t.name,c.value.value=t.price,v.value.value=t.category,g.value.value=t.description,f.value.value=t.sell),i.value.open=!0},U=()=>{i.value.open=!1,i.value.id="",E(),D.value.deleteFileRecord()},T=["遊戲","電子產品","服裝","家居用品","書籍","玩具","食品","其他"],{handleSubmit:j,resetForm:E,isSubmitting:x}=re({validationSchema:oe({name:A().required("商品名稱必須填寫").max(100,"商品名稱最多只能 100 個字元"),price:ie().typeError("價格必須填寫").required("價格必須填寫").min(0,"價格不能是負數"),category:A().required("分類必須填寫").oneOf(T,"請選擇有效的分類"),description:A().max(500,"描述最多只能 500 個字元"),sell:se().required("是否上架必須填寫")}),initialValues:{name:"",price:0,category:"",description:"",sell:!1}}),p=m("name"),c=m("price"),v=m("category"),g=m("description"),f=m("sell"),n=u([]),B=u([]),I=j(async t=>{var e,V,a;if((e=n.value[0])!=null&&e.error){d({text:"請選擇有效的圖片檔案",snackbarProps:{color:"red"}});return}if(i.value.id.length===0&&n.value.length===0){d({text:"請上傳商品圖片",snackbarProps:{color:"red"}});return}try{const s=new FormData;s.append("name",t.name),s.append("price",t.price),s.append("category",t.category),s.append("description",t.description),s.append("sell",t.sell),n.value.length>0&&s.append("image",n.value[0].file),await(i.value.id.length===0?_.create(s):_.update(i.value.id,s)),d({text:"操作成功！",snackbarProps:{color:"green"}}),U(),S()}catch(s){console.error(s),d({text:((a=(V=s==null?void 0:s.response)==null?void 0:V.data)==null?void 0:a.message)||"操作失敗，請稍後再試！",snackbarProps:{color:"red"}})}});return(t,e)=>{const V=H("VueFileAgent");return h(),O(G,null,[l(ne,null,{default:o(()=>[l(de,null,{default:o(()=>[l($,{cols:"12"},{default:o(()=>e[10]||(e[10]=[w("h1",{class:"text-center"},"商品管理",-1)])),_:1,__:[10]}),l(ue),l($,{cols:"12"},{default:o(()=>[l(me,{"filter-keys":N,headers:R,items:F.value,search:k.value},{top:o(()=>[l(pe,null,{default:o(()=>[w("div",Ve,[l(y,{variant:"outlined",onClick:e[0]||(e[0]=a=>M(null))},{default:o(()=>e[11]||(e[11]=[b(" 新增商品 ",-1)])),_:1,__:[11]})]),l(Y),w("div",ye,[l(C,{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=a=>k.value=a),density:"compact",flat:"","hide-details":"",placeholder:"搜尋商品","prepend-inner-icon":"mdi-magnify",variant:"solo",width:"400"},null,8,["modelValue"])])]),_:1})]),"item.image":o(({value:a})=>[l(X,{src:a,width:"75"},null,8,["src"])]),"item.sell":o(({value:a})=>[a?(h(),J(W,{key:0,icon:"mdi-check"})):Q("",!0)]),"item.action":o(({item:a})=>[l(y,{icon:"mdi-pencil",variant:"text",onClick:s=>M(a)},null,8,["onClick"])]),_:2},1032,["items","search"])]),_:1})]),_:1})]),_:1}),l(K,{modelValue:i.value.open,"onUpdate:modelValue":e[9]||(e[9]=a=>i.value.open=a),persistent:"",width:"600"},{default:o(()=>[l(ce,{disabled:r(x),onSubmit:Z(r(I),["prevent"])},{default:o(()=>[l(ee,null,{default:o(()=>[l(ae,null,{default:o(()=>[b(q(i.value.id.length>0?"編輯商品":"新增商品"),1)]),_:1}),l(le,null,{default:o(()=>[l(C,{modelValue:r(p).value.value,"onUpdate:modelValue":e[2]||(e[2]=a=>r(p).value.value=a),"error-messages":r(p).errorMessage.value,label:"名稱"},null,8,["modelValue","error-messages"]),l(C,{modelValue:r(c).value.value,"onUpdate:modelValue":e[3]||(e[3]=a=>r(c).value.value=a),modelModifiers:{number:!0},"error-messages":r(c).errorMessage.value,label:"價格",min:"0",type:"number"},null,8,["modelValue","error-messages"]),l(ve,{modelValue:r(v).value.value,"onUpdate:modelValue":e[4]||(e[4]=a=>r(v).value.value=a),"error-messages":r(v).errorMessage.value,items:T,label:"分類"},null,8,["modelValue","error-messages"]),l(ge,{modelValue:r(g).value.value,"onUpdate:modelValue":e[5]||(e[5]=a=>r(g).value.value=a),"error-messages":r(g).errorMessage.value,label:"描述"},null,8,["modelValue","error-messages"]),l(V,{ref_key:"fileAgent",ref:D,modelValue:n.value,"onUpdate:modelValue":e[6]||(e[6]=a=>n.value=a),"raw-model-value":B.value,"onUpdate:rawModelValue":e[7]||(e[7]=a=>B.value=a),accept:"image/jpeg,image/png",deletable:"","error-text":{type:"檔案格式不正確",size:"檔案大小不得超過 1MB"},"help-text":"選擇或拖拽檔案","max-size":"1MB"},null,8,["modelValue","raw-model-value"]),l(fe,{modelValue:r(f).value.value,"onUpdate:modelValue":e[8]||(e[8]=a=>r(f).value.value=a),"error-messages":r(f).errorMessage.value,"hide-details":"",label:"上架"},null,8,["modelValue","error-messages"])]),_:1}),l(te,null,{default:o(()=>[l(y,{color:"red",disabled:r(x),onClick:U},{default:o(()=>e[12]||(e[12]=[b(" 取消 ",-1)])),_:1,__:[12]},8,["disabled"]),l(y,{color:"green",loading:r(x),type:"submit"},{default:o(()=>[b(q(i.value.id.length>0?"編輯":"新增"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};typeof P=="function"&&P(be);export{be as default};
