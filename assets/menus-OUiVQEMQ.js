import{am as c,ab as R,r as D,y as z,e as _,w as s,o as w,c as t,f as E,i as d,ae as k,V as m,a9 as G,j as H,ai as g,an as J,ao as K,h as r,aj as L,ak as O,al as Q,ap as W}from"./index-AWgwsy0c.js";import{u as X,c as Y,a as S,b as Z,d as y}from"./index.esm-D7IRi73Z.js";import{b as h}from"./route-block-B_A1xBdJ.js";import{V as ee}from"./VContainer-DdjiTbVz.js";import{V as ae,a as T}from"./VRow-DgrlSwcS.js";import{V as te}from"./VDivider-DMIPa6pT.js";import{V as le}from"./VDataTable-BWFFZXyR.js";import{V as oe}from"./VChip-BXeRU_1z.js";import{a as se}from"./VToolbar-BlAZ4Cry.js";import{V as re}from"./VForm-BiP2f0f4.js";import"./VPagination-DoiRKGmI.js";import"./VSelect-C4kuFK5Q.js";import"./VList-Dn2VOZxI.js";import"./VMenu-DoDXjbwU.js";import"./VCheckboxBtn-DDuY08wn.js";import"./filter-C9uyxmCX.js";const v={getAll(){return c.apiAuth.get("/menus")},create(u){return c.apiAuth.post("/menus",u)},getMenuById(u){return c.api.get(`/menus/${u}`)},updateMenu(u,i){return c.apiAuth.patch(`/menus/${u}`,i)},deleteMenu(u){return c.apiAuth.delete(`/menus/${u}`)}},ne={__name:"menus",setup(u){const i=R(),$=D([]),x=D(""),U=[{title:"圖片",key:"image",sortable:!1},{title:"餐廳",key:"restaurant.name"},{title:"名稱",key:"name"},{title:"價格",key:"price"},{title:"標籤",key:"tags"},{title:"狀態",value:"isDeleted"},{title:"操作",key:"action",sortable:!1}],p=async()=>{try{const{data:l}=await v.getAll();console.log("前端/pages/admin/menu.js getMenus API回傳",l),$.value=l.data}catch{i({text:"無法載入菜單資料",snackbarProps:{color:"red"}})}};p();const n=D({open:!1,id:""}),A=l=>{var a;l&&(n.value.id=l._id,V.value.value=l.name,f.value.value=l.price,b.value.value=l.image,M.value.value=((a=l.tags)==null?void 0:a.join(","))||""),n.value.open=!0},P=()=>{n.value.open=!1,n.value.id="",F()},{handleSubmit:B,resetForm:F,isSubmitting:C}=X({validationSchema:Y({name:S().required("菜單名稱必須填寫").max(100),price:Z().required("價格必須填寫").min(0),image:S().url("請輸入有效網址").max(200),tags:S()}),initialValues:{name:"",price:0,image:"",tags:""}}),V=y("name"),f=y("price"),b=y("image"),M=y("tags"),j=B(async l=>{var a,e;try{const o={name:l.name,price:l.price,image:l.image,tags:l.tags?l.tags.split(",").map(q=>q.trim()):[]};await(n.value.id.length===0?v.create(o):v.updateMenu(n.value.id,o)),i({text:"操作成功！",snackbarProps:{color:"green"}}),P(),p()}catch(o){i({text:((e=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:e.message)||"操作失敗",snackbarProps:{color:"red"}})}}),I=async l=>{var a,e;try{await v.updateMenu(l,{isDeleted:!0}),i({text:"菜單已軟刪除",snackbarProps:{color:"orange"}}),p()}catch(o){i({text:((e=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:e.message)||"操作失敗",snackbarProps:{color:"red"}})}},N=async l=>{var a,e;try{await v.updateMenu(l,{isDeleted:!1}),i({text:"菜單已還原",snackbarProps:{color:"green"}}),p()}catch(o){i({text:((e=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:e.message)||"操作失敗",snackbarProps:{color:"red"}})}};return z(p),(l,a)=>(w(),_(ee,null,{default:s(()=>[t(ae,null,{default:s(()=>[t(T,{cols:"12"},{default:s(()=>a[7]||(a[7]=[E("h1",{class:"text-center"},"菜單管理",-1)])),_:1,__:[7]}),t(te),t(T,{cols:"12"},{default:s(()=>[t(le,{headers:U,items:$.value,search:x.value},{top:s(()=>[t(se,null,{default:s(()=>[t(m,{variant:"outlined",onClick:a[0]||(a[0]=e=>A(null))},{default:s(()=>a[8]||(a[8]=[d("新增菜單",-1)])),_:1,__:[8]}),t(H),t(g,{modelValue:x.value,"onUpdate:modelValue":a[1]||(a[1]=e=>x.value=e),density:"compact","hide-details":"",placeholder:"搜尋菜單","prepend-inner-icon":"mdi-magnify",variant:"solo"},null,8,["modelValue"])]),_:1})]),"item.image":s(({value:e})=>[t(G,{src:e,width:"75"},null,8,["src"])]),"item.restaurant.name":s(({item:e})=>{var o;return[d(k(((o=e.restaurant)==null?void 0:o.name)||"未指定"),1)]}),"item.action":s(({item:e})=>[t(m,{icon:"mdi-pencil",variant:"text",onClick:o=>A(e)},null,8,["onClick"]),e.isDeleted?(w(),_(m,{key:1,color:"green",icon:"mdi-restore",variant:"text",onClick:o=>N(e._id)},null,8,["onClick"])):(w(),_(m,{key:0,color:"red",icon:"mdi-delete",variant:"text",onClick:o=>I(e._id)},null,8,["onClick"]))]),"item.isDeleted":s(({item:e})=>[t(oe,{color:e.isDeleted?"red":"green",dark:""},{default:s(()=>[d(k(e.isDeleted?"已刪除":"正常"),1)]),_:2},1032,["color"])]),_:2},1032,["items","search"])]),_:1})]),_:1}),t(J,{modelValue:n.value.open,"onUpdate:modelValue":a[6]||(a[6]=e=>n.value.open=e),persistent:"",width:"700"},{default:s(()=>[t(re,{disabled:r(C),onSubmit:K(r(j),["prevent"])},{default:s(()=>[t(L,null,{default:s(()=>[t(O,null,{default:s(()=>[d(k(n.value.id?"編輯菜單":"新增菜單"),1)]),_:1}),t(Q,null,{default:s(()=>[t(g,{modelValue:r(V).value.value,"onUpdate:modelValue":a[2]||(a[2]=e=>r(V).value.value=e),"error-messages":r(V).errorMessage.value,label:"名稱"},null,8,["modelValue","error-messages"]),t(g,{modelValue:r(f).value.value,"onUpdate:modelValue":a[3]||(a[3]=e=>r(f).value.value=e),"error-messages":r(f).errorMessage.value,label:"價格",type:"number"},null,8,["modelValue","error-messages"]),t(g,{modelValue:r(b).value.value,"onUpdate:modelValue":a[4]||(a[4]=e=>r(b).value.value=e),"error-messages":r(b).errorMessage.value,label:"圖片網址"},null,8,["modelValue","error-messages"]),t(g,{modelValue:r(M).value.value,"onUpdate:modelValue":a[5]||(a[5]=e=>r(M).value.value=e),label:"標籤（逗號分隔）"},null,8,["modelValue"])]),_:1}),t(W,null,{default:s(()=>[t(m,{color:"red",disabled:r(C),onClick:P},{default:s(()=>a[9]||(a[9]=[d("取消",-1)])),_:1,__:[9]},8,["disabled"]),t(m,{color:"green",loading:r(C),type:"submit"},{default:s(()=>[d(k(n.value.id?"編輯":"新增"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])]),_:1}))}};typeof h=="function"&&h(ne);export{ne as default};
