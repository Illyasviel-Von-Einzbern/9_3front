import{o as L}from"./order-Dq5cgiZr.js";import{b}from"./route-block-B_A1xBdJ.js";import{V as M}from"./VContainer-DdjiTbVz.js";import{V as z,a as H}from"./VRow-DgrlSwcS.js";import{r as f,z as U,v as c,e as m,w as a,o as s,f as w,c as l,ai as W,h as Y,aj as j,ak as I,i as n,al as O,q as y,F as v,s as _,ae as u}from"./index-AWgwsy0c.js";import{V as Q,a as A}from"./VTabs-BCTOQfGk.js";import{V as R}from"./VDivider-DMIPa6pT.js";import{V as $,a as D,b as q,c as S}from"./VExpansionPanels-BaXzTRH7.js";import{V as P}from"./VDataTable-BWFFZXyR.js";import{V as G}from"./VAlert-tqLe5aL3.js";import"./VChip-BXeRU_1z.js";import"./VPagination-DoiRKGmI.js";import"./VSelect-C4kuFK5Q.js";import"./VList-Dn2VOZxI.js";import"./VMenu-DoDXjbwU.js";import"./VCheckboxBtn-DDuY08wn.js";import"./filter-C9uyxmCX.js";const J={class:"pl-0",style:{"list-style-type":"none"}},K={__name:"historys",setup(N){const d=f(""),h=new Date().toISOString().slice(0,10),i=f([]),k=f(!1),p=f("user"),B=[{title:"餐廳",key:"restaurant.name"},{title:"餐點內容",key:"items"},{title:"訂購人",key:"user.account"},{title:"總價",key:"totalPrice"},{title:"時間",key:"createdAt"}],C=[{title:"訂購人",key:"user",sortable:!0},{title:"數量",key:"quantity",sortable:!0},{title:"時間",key:"createdAt",sortable:!0}];U(d,async()=>{if(!d.value){i.value=[];return}k.value=!0;try{const{data:r}=await L.getAll();i.value=r.data.filter(e=>{const t=new Date(e.createdAt),o=new Date(d.value);return t.getFullYear()===o.getFullYear()&&t.getMonth()===o.getMonth()&&t.getDate()===o.getDate()})}finally{k.value=!1}});const g=c(()=>{const r=new Set(i.value.map(e=>e.user.account));return Array.from(r)}),E=c(()=>{const r={};for(const e of g.value)r[e]=i.value.filter(t=>t.user.account===e);return r}),x=c(()=>{const r=new Set;for(const e of i.value)for(const t of e.items)r.add(t.name);return Array.from(r)}),T=c(()=>{const r={};for(const e of x.value)r[e]=[];for(const e of i.value)for(const t of e.items)r[t.name]&&r[t.name].push({user:e.user.account,quantity:t.quantity,createdAt:e.createdAt});return r}),F=r=>{var e;return((e=T.value[r])==null?void 0:e.reduce((t,o)=>t+o.quantity,0))||0};return(r,e)=>(s(),m(M,null,{default:a(()=>[e[5]||(e[5]=w("h1",{class:"text-center"},"歷史訂單管理",-1)),l(z,null,{default:a(()=>[l(H,{cols:"12",md:"4"},{default:a(()=>[l(W,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=t=>d.value=t),clearable:"",label:"選擇日期",max:Y(h),type:"date"},null,8,["modelValue","max"])]),_:1})]),_:1}),i.value.length>0?(s(),m(j,{key:0},{default:a(()=>[l(I,null,{default:a(()=>[l(Q,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=t=>p.value=t),grow:""},{default:a(()=>[l(A,{value:"user"},{default:a(()=>e[2]||(e[2]=[n("依訂購人分群",-1)])),_:1,__:[2]}),l(A,{value:"menu"},{default:a(()=>e[3]||(e[3]=[n("依餐點分群",-1)])),_:1,__:[3]})]),_:1},8,["modelValue"])]),_:1}),l(R),l(O,null,{default:a(()=>[l($,null,{default:a(()=>[p.value==="user"?(s(!0),y(v,{key:0},_(g.value,t=>(s(),m(D,{key:t},{default:a(()=>[l(q,null,{default:a(()=>[n(u(t),1)]),_:2},1024),l(S,null,{default:a(()=>[l(P,{class:"mb-4",headers:B,"hide-default-footer":"",items:E.value[t]},{"item.createdAt":a(({item:o})=>[n(u(new Date(o.createdAt).toLocaleTimeString("zh-TW")),1)]),"item.items":a(({item:o})=>[w("ul",J,[(s(!0),y(v,null,_(o.items,V=>(s(),y("li",{key:V.menuItemId},u(V.name)+" x "+u(V.quantity),1))),128))])]),"item.totalPrice":a(({item:o})=>[n(" $"+u(o.totalPrice),1)]),_:2},1032,["items"])]),_:2},1024)]),_:2},1024))),128)):(s(!0),y(v,{key:1},_(x.value,t=>(s(),m(D,{key:t},{default:a(()=>[l(q,null,{default:a(()=>[n(u(t)+"（總數量："+u(F(t))+"） ",1)]),_:2},1024),l(S,null,{default:a(()=>[l(P,{class:"mb-4",headers:C,"hide-default-footer":"",items:T.value[t]},{"item.createdAt":a(({item:o})=>[n(u(new Date(o.createdAt).toLocaleTimeString("zh-TW")),1)]),"item.quantity":a(({item:o})=>[n(u(o.quantity),1)]),_:2},1032,["items"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):(s(),m(G,{key:1,class:"mt-4",type:"info"},{default:a(()=>e[4]||(e[4]=[n("查無訂單紀錄",-1)])),_:1,__:[4]}))]),_:1,__:[5]}))}};typeof b=="function"&&b(K);export{K as default};
