import{ab as Y,r as p,v as c,y as j,e as _,w as a,o as u,c as l,f as V,V as H,i as n,aj as N,ak as O,al as Q,q as m,ad as R,F as v,s as g,ae as s}from"./index-CIHyU37z.js";import{o as G}from"./order-DL-Hqn57.js";import{b as S}from"./route-block-B_A1xBdJ.js";import{V as I}from"./VContainer-Czllfyk0.js";import{V as J,a as L}from"./VRow-BQerUWQv.js";import{V as K,a as k}from"./VTabs-BPDEvzws.js";import{V as X}from"./VDivider-3u-8eSsr.js";import{V as Z,a as b,b as T,c as A}from"./VExpansionPanels-hQSvvBff.js";import{V as w}from"./VDataTable-f5nkd4zz.js";import"./VChip-Crq8nVJ7.js";import"./VPagination-CLol_7gt.js";import"./VSelect-CxX8EwAn.js";import"./VList-CdzutsXp.js";import"./VMenu-D_8JceEl.js";import"./VCheckboxBtn-BFND6HbK.js";import"./filter-BW8gkpM9.js";const ee={class:"pl-0",style:{"list-style-type":"none"}},te={class:"pl-0",style:{"list-style-type":"none"}},ae={__name:"index",setup(re){const M=Y(),f=p(!0),i=p([]),y=p("user"),x=p(null),h=p(null),C=[{title:"種類",key:"restaurant.category",sortable:!0},{title:"餐廳",key:"restaurant.name",sortable:!0},{title:"餐點內容",key:"items",sortable:!1,align:"start"},{title:"訂購人",key:"user.account",sortable:!0},{title:"總價",key:"totalPrice",sortable:!0,align:"end"},{title:"時間",key:"createdAt",sortable:!0}],E=[{title:"訂購人",key:"user",sortable:!0},{title:"數量",key:"quantity",sortable:!0},{title:"時間",key:"createdAt",sortable:!0}],F=r=>{const e=new Date(r),t=new Date;return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()},$=async()=>{var r,e;f.value=!0;try{const{data:t}=await G.getAll();i.value=t.data.filter(o=>F(o.createdAt))}catch(t){console.error("無法載入訂單",t),M({text:((e=(r=t.response)==null?void 0:r.data)==null?void 0:e.message)||"無法載入訂單",snackbarProps:{color:"error"}})}finally{f.value=!1}},D=c(()=>{const r=new Set(i.value.map(e=>e.user.account));return Array.from(r)}),z=c(()=>{const r={};for(const e of D.value)r[e]=i.value.filter(t=>t.user.account===e);return r}),P=c(()=>{const r=new Set;for(const e of i.value)for(const t of e.items)r.add(t.name);return Array.from(r)}),q=c(()=>{const r={};for(const e of P.value)r[e]=[];for(const e of i.value)for(const t of e.items)r[t.name]&&r[t.name].push({user:e.user.account,quantity:t.quantity,createdAt:e.createdAt});return r}),B=c(()=>{const r=new Set(i.value.map(e=>e.restaurant.category));return Array.from(r).filter(Boolean)}),U=c(()=>{const r={};for(const e of B.value)r[e]=i.value.filter(t=>t.restaurant.category===e);return r}),W=r=>{var e;return((e=q.value[r])==null?void 0:e.reduce((t,o)=>t+o.quantity,0))||0};return c(()=>i.value.filter(r=>{const e=!x.value||r.user.account===x.value,t=!h.value||r.restaurant.category===h.value;return e&&t})),j(()=>{$()}),(r,e)=>(u(),_(I,null,{default:a(()=>[l(J,null,{default:a(()=>[l(L,{cols:"10"},{default:a(()=>e[2]||(e[2]=[V("h1",{class:"text-h4 mb-4"},"今日訂餐分群總覽",-1)])),_:1,__:[2]}),l(L,{cols:"2"},{default:a(()=>[l(H,{color:"primary",onClick:e[0]||(e[0]=t=>r.$router.push("/orders/history"))},{default:a(()=>e[3]||(e[3]=[n(" 查詢歷史訂單 ",-1)])),_:1,__:[3]})]),_:1})]),_:1}),l(N,null,{default:a(()=>[l(O,null,{default:a(()=>[l(K,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=t=>y.value=t),grow:""},{default:a(()=>[l(k,{value:"user"},{default:a(()=>e[4]||(e[4]=[n("依訂購人分群",-1)])),_:1,__:[4]}),l(k,{value:"menu"},{default:a(()=>e[5]||(e[5]=[n("依餐點分群",-1)])),_:1,__:[5]}),l(k,{value:"category"},{default:a(()=>e[6]||(e[6]=[n("依種類分群",-1)])),_:1,__:[6]})]),_:1},8,["modelValue"])]),_:1}),l(X),l(Q,null,{default:a(()=>[l(Z,null,{default:a(()=>[y.value==="user"?(u(!0),m(v,{key:0},g(D.value,t=>(u(),_(b,{key:t},{default:a(()=>[l(T,null,{default:a(()=>[n(s(t),1)]),_:2},1024),l(A,null,{default:a(()=>[l(w,{class:"mb-4",headers:C,"hide-default-footer":"",items:z.value[t],loading:f.value},{"item.createdAt":a(({item:o})=>[n(s(new Date(o.createdAt).toLocaleTimeString("zh-TW")),1)]),"item.items":a(({item:o})=>[V("ul",ee,[(u(!0),m(v,null,g(o.items,d=>(u(),m("li",{key:d.menuItemId},s(d.name)+" x "+s(d.quantity),1))),128))])]),"item.totalPrice":a(({item:o})=>[n(" $"+s(o.totalPrice),1)]),_:2},1032,["items","loading"])]),_:2},1024)]),_:2},1024))),128)):y.value==="menu"?(u(!0),m(v,{key:1},g(P.value,t=>(u(),_(b,{key:t},{default:a(()=>[l(T,null,{default:a(()=>[n(s(t)+"（總數量："+s(W(t))+"） ",1)]),_:2},1024),l(A,null,{default:a(()=>[l(w,{class:"mb-4",headers:E,"hide-default-footer":"",items:q.value[t],loading:f.value},{"item.createdAt":a(({item:o})=>[n(s(new Date(o.createdAt).toLocaleTimeString("zh-TW")),1)]),"item.quantity":a(({item:o})=>[n(s(o.quantity),1)]),_:2},1032,["items","loading"])]),_:2},1024)]),_:2},1024))),128)):y.value==="category"?(u(!0),m(v,{key:2},g(B.value,t=>(u(),_(b,{key:t},{default:a(()=>[l(T,null,{default:a(()=>[n(s(t),1)]),_:2},1024),l(A,null,{default:a(()=>[l(w,{class:"mb-4",headers:C,"hide-default-footer":"",items:U.value[t],loading:f.value},{"item.createdAt":a(({item:o})=>[n(s(new Date(o.createdAt).toLocaleTimeString("zh-TW")),1)]),"item.items":a(({item:o})=>[V("ul",te,[(u(!0),m(v,null,g(o.items,d=>(u(),m("li",{key:d.menuItemId},s(d.name)+" x "+s(d.quantity),1))),128))])]),"item.totalPrice":a(({item:o})=>[n(" $"+s(o.totalPrice),1)]),_:2},1032,["items","loading"])]),_:2},1024)]),_:2},1024))),128)):R("",!0)]),_:1})]),_:1})]),_:1})]),_:1}))}};typeof S=="function"&&S(ae);export{ae as default};
